!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t(e.THREEAR={},e.THREE)}(this,function(e,t){"use strict";function i(e,t,i){var r=void 0,n=void 0;return function(){for(var a=arguments.length,s=Array(a),o=0;o<a;o++)s[o]=arguments[o];var l=+new Date,h=void 0;r&&(h=r+t-l),void 0==h||h<0?(r=l,e.apply(i,s)):h>=0&&(clearTimeout(n),n=setTimeout(function(){r=l,e.apply(i,s)},h))}}function r(e,t,i){var r=void 0;if("fragment"==i)r=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=i)return null;r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(alert(e.getShaderInfoLog(r)),null)}function n(e,t,i){var n=r(e,t,"vertex"),a=r(e,i,"fragment");if(!a)return null;var s=e.createProgram();return e.attachShader(s,n),e.attachShader(s,a),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||alert("Could not initialise arview shaders"),s}function a(e,t){var i=0;switch(t){case 90:i=1;break;case 180:i=2;break;case 270:i=3;break;default:i=0}var r=0;switch(e){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var n=r-i;return n<0&&(n+=4),n%4}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=(function(){function e(e){this.value=e}function t(t){function i(n,a){try{var s=t[n](a),o=s.value;o instanceof e?Promise.resolve(o.value).then(function(e){i("next",e)},function(e){i("throw",e)}):r(s.done?"return":"normal",s.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?i(n.key,n.arg):a=null}var n,a;this._invoke=function(e,t){return new Promise(function(r,s){var o={key:e,arg:t,resolve:r,reject:s,next:null};a?a=a.next=o:(n=a=o,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),h=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)},u=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},f=function(){function e(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p={open:!0,showLastHit:!0,showPoseStatus:!0},d=new Map,v=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.config=Object.assign({},i,p),this.vrDisplay=t,this._view=new m({open:this.config.open}),this.config.showLastHit&&this.vrDisplay.hitTest&&this._view.addRow("hit-test",new y(t)),this.config.showPoseStatus&&this.vrDisplay.getFrameData&&this._view.addRow("pose-status",new b(t))}return l(e,[{key:"open",value:function(){this._view.open()}},{key:"close",value:function(){this._view.close()}},{key:"getElement",value:function(){return this._view.getElement()}}]),e}(),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.rows=new Map,this.el=document.createElement("div"),this.el.style.backgroundColor="#333",this.el.style.padding="5px",this.el.style.fontFamily="Roboto, Ubuntu, Arial, sans-serif",this.el.style.color="rgb(165, 165, 165)",this.el.style.position="absolute",this.el.style.right="20px",this.el.style.top="0px",this.el.style.width="200px",this.el.style.fontSize="12px",this.el.style.zIndex=9999,this._rowsEl=document.createElement("div"),this._rowsEl.style.transitionProperty="max-height",this._rowsEl.style.transitionDuration="0.5s",this._rowsEl.style.transitionDelay="0s",this._rowsEl.style.transitionTimingFunction="ease-out",this._rowsEl.style.overflow="hidden",this._controls=document.createElement("div"),this._controls.style.fontSize="13px",this._controls.style.fontWeight="bold",this._controls.style.paddingTop="5px",this._controls.style.textAlign="center",this._controls.style.cursor="pointer",this._controls.addEventListener("click",this.toggleControls.bind(this)),t.open?this.open():this.close(),this.el.appendChild(this._rowsEl),this.el.appendChild(this._controls)}return l(e,[{key:"toggleControls",value:function(){this._isOpen?this.close():this.open()}},{key:"open",value:function(){this._rowsEl.style.maxHeight="100px",this._isOpen=!0,this._controls.textContent="Close ARDebug";var e=!0,t=!1,i=void 0;try{for(var r,n=this.rows[Symbol.iterator]();!(e=(r=n.next()).done);e=!0)f(r.value,2)[1].enable()}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"close",value:function(){this._rowsEl.style.maxHeight="0px",this._isOpen=!1,this._controls.textContent="Open ARDebug";var e=!0,t=!1,i=void 0;try{for(var r,n=this.rows[Symbol.iterator]();!(e=(r=n.next()).done);e=!0)f(r.value,2)[1].disable()}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"getElement",value:function(){return this.el}},{key:"addRow",value:function(e,t){this.rows.set(e,t),this._isOpen&&t.enable(),this._rowsEl.appendChild(t.getElement())}}]),e}(),g=function(){function e(t){o(this,e),this.el=document.createElement("div"),this.el.style.width="100%",this.el.style.borderTop="1px solid rgb(54, 54, 54)",this.el.style.borderBottom="1px solid #14171A",this.el.style.position="relative",this.el.style.padding="3px 0px",this.el.style.overflow="hidden",this._titleEl=document.createElement("span"),this._titleEl.style.fontWeight="bold",this._titleEl.textContent=t,this._dataEl=document.createElement("span"),this._dataEl.style.position="absolute",this._dataEl.style.left="40px",this._dataElText=document.createTextNode(""),this._dataEl.appendChild(this._dataElText),this.el.appendChild(this._titleEl),this.el.appendChild(this._dataEl),this.update=i(this.update,500,this)}return l(e,[{key:"enable",value:function(){throw new Error("Implement in child class")}},{key:"disable",value:function(){throw new Error("Implement in child class")}},{key:"getElement",value:function(){return this.el}},{key:"update",value:function(e,t){this._dataElText.nodeValue=e,this._dataEl.style.color=t?"#00ff00":"#ff0077"}}]),e}(),y=function(e){function t(e){o(this,t);var i=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Hit"));return i.vrDisplay=e,i._onHitTest=i._onHitTest.bind(i),i._nativeHitTest=d.get("hitTest")||i.vrDisplay.hitTest,d.set("hitTest",i._nativeHitTest),i._didPreviouslyHit=null,i}return u(t,g),l(t,[{key:"enable",value:function(){this.vrDisplay.hitTest=this._onHitTest}},{key:"disable",value:function(){this.vrDisplay.hitTest=this._nativeHitTest}},{key:"_hitToString",value:function(e){var t=e.modelMatrix;return t[12].toFixed(2)+", "+t[13].toFixed(2)+", "+t[14].toFixed(2)}},{key:"_onHitTest",value:function(e,t){var i=this._nativeHitTest.call(this.vrDisplay,e,t),r=(parseInt(performance.now(),10)/1e3).toFixed(1),n=i&&i.length;return this.update((n?this._hitToString(i[0]):"MISS")+" @ "+r+"s",n),this._didPreviouslyHit=n,i}}]),t}(),b=function(e){function t(e){o(this,t);var i=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Pose"));return i.vrDisplay=e,i._onGetFrameData=i._onGetFrameData.bind(i),i._nativeGetFrameData=d.get("getFrameData")||i.vrDisplay.getFrameData,d.set("getFrameData",i._nativeGetFrameData),i.update("Looking for position..."),i._initialPose=!1,i}return u(t,g),l(t,[{key:"enable",value:function(){this.vrDisplay.getFrameData=this._onGetFrameData}},{key:"disable",value:function(){this.vrDisplay.getFrameData=this._nativeGetFrameData}},{key:"_poseToString",value:function(e){return e[0].toFixed(2)+", "+e[1].toFixed(2)+", "+e[2].toFixed(2)}},{key:"_onGetFrameData",value:function(e){var t=this._nativeGetFrameData.call(this.vrDisplay,e),i=e&&e.pose&&e.pose.position,r=i&&"number"==typeof i[0]&&"number"==typeof i[1]&&"number"==typeof i[2]&&!(0===i[0]&&0===i[1]&&0===i[2]);return this._initialPose||r?(r?this.update(this._poseToString(i),!0):r||!1===this._lastPoseValid||this.update("Position lost",!1),this._lastPoseValid=r,this._initialPose=!0,t):t}}]),t}(),w=void 0,x=function(e){function t(e,i,r,n,a){o(this,t);var s=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,r,n,a));return s.isARPerpsectiveCamera=!0,s.vrDisplay=e,s.updateProjectionMatrix(),e&&e.capabilities.hasPassThroughCamera||console.warn("ARPerspectiveCamera does not a VRDisplay with\n                    a pass through camera. Using supplied values and defaults\n                    instead of device camera intrinsics"),s}return u(t,e),l(t,[{key:"updateProjectionMatrix",value:function(){var e=this.getProjectionMatrix();e?this.projectionMatrix.fromArray(e):h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateProjectionMatrix",this).call(this)}},{key:"getProjectionMatrix",value:function(){return this.vrDisplay&&this.vrDisplay.getFrameData?(w||(w=new VRFrameData),this.vrDisplay.getFrameData(w),w.leftProjectionMatrix):null}}]),t}(t.PerspectiveCamera),_=/^[og]\s*(.+)?/,A=/^mtllib /,E=/^usemtl /,T=function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,a,s,o,l){var h=this.vertices.length,u=this.parseVertexIndex(e,h),c=this.parseVertexIndex(t,h),f=this.parseVertexIndex(i,h);if(this.addVertex(u,c,f),void 0!==r){var p=this.uvs.length;u=this.parseUVIndex(r,p),c=this.parseUVIndex(n,p),f=this.parseUVIndex(a,p),this.addUV(u,c,f)}if(void 0!==s){var d=this.normals.length;u=this.parseNormalIndex(s,d),c=s===o?u:this.parseNormalIndex(o,d),f=s===l?u:this.parseNormalIndex(l,d),this.addNormal(u,c,f)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,a=e.length;n<a;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));for(var s=0,o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return e.startObject("",!1),e},R=function(){function e(i){o(this,e),this.manager=void 0!==i?i:t.DefaultLoadingManager,this.materials=null}return l(e,[{key:"load",value:function(e,i,r,n){var a=this,s=new t.FileLoader(a.manager);s.setPath(this.path),s.load(e,function(e){i(a.parse(e))},r,n)}},{key:"setPath",value:function(e){this.path=e}},{key:"setMaterials",value:function(e){return this.materials=e,this}},{key:"parse",value:function(e){console.time("OBJLoader");var i=new T;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var r=e.split("\n"),n="",a="",s=[],o="function"==typeof"".trimLeft,l=0,h=r.length;l<h;l++)if(n=r[l],n=o?n.trimLeft():n.trim(),0!==n.length&&"#"!==(a=n.charAt(0))){if("v"===a){var u=n.split(/\s+/);switch(u[0]){case"v":i.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vn":i.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vt":i.uvs.push(parseFloat(u[1]),parseFloat(u[2]))}}else if("f"===a){for(var c=n.substr(1).trim().split(/\s+/),f=[],p=0,d=c.length;p<d;p++){var v=c[p];if(v.length>0){var m=v.split("/");f.push(m)}}for(var g=f[0],y=1,b=f.length-1;y<b;y++){var w=f[y],x=f[y+1];i.addFace(g[0],w[0],x[0],g[1],w[1],x[1],g[2],w[2],x[2])}}else if("l"===a){var R=n.substring(1).trim().split(" "),L=[],k=[];if(-1===n.indexOf("/"))L=R;else for(var S=0,F=R.length;S<F;S++){var O=R[S].split("/");""!==O[0]&&L.push(O[0]),""!==O[1]&&k.push(O[1])}i.addLineGeometry(L,k)}else if(null!==(s=_.exec(n))){var P=(" "+s[0].substr(1).trim()).substr(1);i.startObject(P)}else if(E.test(n))i.object.startMaterial(n.substring(7).trim(),i.materialLibraries);else if(A.test(n))i.materialLibraries.push(n.substring(7).trim());else if("s"===a){if((s=n.split(" ")).length>1){var C=s[1].trim().toLowerCase();i.object.smooth="0"!==C&&"off"!==C}else i.object.smooth=!0;var D=i.object.currentMaterial();if(!D){if("\0"===n)continue;throw new Error("Unexpected line: '"+n+"'")}D.smooth=i.object.smooth}i.finalize();var I=new t.Group;I.materialLibraries=[].concat(i.materialLibraries);for(var M=0,B=i.objects.length;M<B;M++){var j=i.objects[M],U=j.geometry,V=j.materials,H="Line"===U.type;if(0!==U.vertices.length){var N=new t.BufferGeometry;N.addAttribute("position",new t.BufferAttribute(new Float32Array(U.vertices),3)),U.normals.length>0?N.addAttribute("normal",new t.BufferAttribute(new Float32Array(U.normals),3)):N.computeVertexNormals(),U.uvs.length>0&&N.addAttribute("uv",new t.BufferAttribute(new Float32Array(U.uvs),2));for(var G=[],W=0,Y=V.length;W<Y;W++){var z=V[W],X=void 0;if(null!==this.materials&&(X=this.materials.create(z.name),H&&X&&!(X instanceof t.LineBasicMaterial))){var q=new t.LineBasicMaterial;q.copy(X),X=q}X||((X=H?new t.LineBasicMaterial:new t.MeshPhongMaterial).name=z.name),X.flatShading=!z.smooth,G.push(X)}var K=void 0;if(G.length>1){for(var J=0,Q=V.length;J<Q;J++){var Z=V[J];N.addGroup(Z.groupStart,Z.groupCount,J)}K=H?new t.LineSegments(N,G):new t.Mesh(N,G)}else K=H?new t.LineSegments(N,G[0]):new t.Mesh(N,G[0]);K.name=j.name,I.add(K)}}return console.timeEnd("OBJLoader"),I}}}]),e}(),L=function(){function e(i){o(this,e),this.manager=void 0!==i?i:t.DefaultLoadingManager}return l(e,[{key:"load",value:function(e,i,r,n){var a=this,s=new t.FileLoader(this.manager);s.setPath(this.path),s.load(e,function(e){i(a.parse(e))},r,n)}},{key:"setPath",value:function(e){this.path=e}},{key:"setTexturePath",value:function(e){this.texturePath=e}},{key:"setBaseUrl",value:function(e){console.warn("MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)}},{key:"setCrossOrigin",value:function(e){this.crossOrigin=e}},{key:"setMaterialOptions",value:function(e){this.materialOptions=e}},{key:"parse",value:function(e){for(var t=e.split("\n"),i={},r=/\s+/,n={},a=0;a<t.length;a++){var s=t[a];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var o=s.indexOf(" "),l=o>=0?s.substring(0,o):s;l=l.toLowerCase();var h=o>=0?s.substring(o+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},n[h]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var u=h.split(r,3);i[l]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else i[l]=h}}var c=new k(this.texturePath||this.path,this.materialOptions);return c.setCrossOrigin(this.crossOrigin),c.setManager(this.manager),c.setMaterials(n),c}}]),e}(),k=function(){function e(i,r){o(this,e),this.baseUrl=i||"",this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="Anonymous",this.side=this.options&&this.options.side?this.options.side:t.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:t.RepeatWrapping}return l(e,[{key:"setCrossOrigin",value:function(e){this.crossOrigin=e}},{key:"setManager",value:function(e){this.manager=e}},{key:"setMaterials",value:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}},{key:"convert",value:function(e){if(!this.options)return e;var t={};for(var i in e)if(e[i]){var r=e[i],n={};t[i]=n;for(var a in r)if(r[a]){var s=!0,o=r[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===o[0]&&0===o[1]&&0===o[2]&&(s=!1)}s&&(n[l]=o)}}return t}},{key:"preload",value:function(){for(var e in this.materialsInfo)this.materialsInfo[e]&&this.create(e)}},{key:"getIndex",value:function(e){return this.nameLookup[e]}},{key:"getAsArray",value:function(){var e=0;for(var t in this.materialsInfo)this.materialsInfo[t]&&(this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++);return this.materialsArray}},{key:"create",value:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}},{key:"createMaterial_",value:function(e){var i=this,r=this.materialsInfo[e],n={name:e,side:this.side},a=function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t},s=function(e,t){if(!n[e]){var r=i.getTextureParams(t,n),s=i.loadTexture(a(i.baseUrl,r.url));s.repeat.copy(r.scale),s.offset.copy(r.offset),s.wrapS=i.wrap,s.wrapT=i.wrap,n[e]=s}};for(var o in r)if(r[o]){var l=r[o],h=void 0;if(""===l)continue;switch(o.toLowerCase()){case"kd":n.color=(new t.Color).fromArray(l);break;case"ks":n.specular=(new t.Color).fromArray(l);break;case"map_kd":s("map",l);break;case"map_ks":s("specularMap",l);break;case"norm":s("normalMap",l);break;case"map_bump":case"bump":s("bumpMap",l);break;case"ns":n.shininess=parseFloat(l);break;case"d":(h=parseFloat(l))<1&&(n.opacity=h,n.transparent=!0);break;case"tr":(h=parseFloat(l))>0&&(n.opacity=1-h,n.transparent=!0)}}return this.materials[e]=new t.MeshPhongMaterial(n),this.materials[e]}},{key:"getTextureParams",value:function(e,i){var r={scale:new t.Vector2(1,1),offset:new t.Vector2(0,0)},n=e.split(/\s+/),a=void 0;return(a=n.indexOf("-bm"))>=0&&(i.bumpScale=parseFloat(n[a+1]),n.splice(a,2)),(a=n.indexOf("-s"))>=0&&(r.scale.set(parseFloat(n[a+1]),parseFloat(n[a+2])),n.splice(a,4)),(a=n.indexOf("-o"))>=0&&(r.offset.set(parseFloat(n[a+1]),parseFloat(n[a+2])),n.splice(a,4)),r.url=n.join(" ").trim(),r}},{key:"loadTexture",value:function(e,i,r,n,a){var s=void 0,o=t.Loader.Handlers.get(e),l=void 0!==this.manager?this.manager:t.DefaultLoadingManager;return null===o&&(o=new t.TextureLoader(l)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),s=o.load(e,r,n,a),void 0!==i&&(s.mapping=i),s}}]),e}(),S=function(){},F=function(e,t){return new Promise(function(i,r){var n=new R;t&&n.setMaterials(t),n.load(e,i,S,r)})},O=function(e){return new Promise(function(t,i){var r=new L,n=e.split("/");n.length>=2&&r.setTexturePath(n[n.length-2]),r.load(e,t,S,i)})},P={};P.isTango=function(e){return e&&e.displayName.toLowerCase().includes("tango")};var C=P.isTango;P.isARKit=function(e){return e&&e.displayName.toLowerCase().includes("arkit")};var D=P.isARKit;P.isARDisplay=function(e){return D(e)||C(e)};var I=P.isARDisplay;P.getARDisplay=function(){return new Promise(function(e,t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){if(t||0!==t.length){var i=!0,r=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var o=a.value;if(I(o))return void e(o)}}catch(e){r=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw n}}e(null)}else e(null)}):e(null)})},P.loadBlocksModel=function(e,i){return new Promise(function(r,n){if(THREE.OBJLoader&&THREE.MTLLoader){var a=Promise.resolve();i&&(a=O(i)),a.then(function(t){return t&&t.preload(),F(e,t)}).then(function(e){var i=e.children[0];return i.geometry.applyMatrix((new t.Matrix4).makeRotationY(t.Math.degToRad(-90))),i}).then(r,n)}else n(new Error("Must include THREE.OBJLoader and THREE.MTLLoader"))})};var M=new t.Matrix4,B=new t.Vector3,j=new t.Quaternion,U=new t.Vector3;P.placeObjectAtHit=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t||!t.modelMatrix)throw new Error("placeObjectAtHit requires a VRHit object");M.fromArray(t.modelMatrix),M.decompose(B,j,U),1===i?(e.position.copy(B),r&&e.quaternion.copy(j)):(e.position.lerp(B,i),r&&e.quaternion.slerp(j,i))};var V=P.placeObjectAtHit;P.displayUnsupportedMessage=function(){var e=document.createElement("div");e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.border="1px solid black",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",e.innerHTML='This augmented reality experience requires\n  WebARonARCore or WebARonARKit, experimental browsers from Google\n  for Android and iOS. Learn more at the <a href="https://developers.google.com/ar/develop/web/getting-started">Google Developers site</a>.',document.body.appendChild(e)};var H=function(e){function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.02,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.05,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16711799,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.25;o(this,i);var l=new t.RingGeometry(r,n,36,64),h=new t.MeshBasicMaterial({color:a});l.applyMatrix((new t.Matrix4).makeRotationX(t.Math.degToRad(-90)));var u=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,l,h));return u.visible=!1,u.easing=s,u.applyOrientation=!0,u.vrDisplay=e,u._planeDir=new t.Vector3,u}return u(i,e),l(i,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(this.vrDisplay&&this.vrDisplay.hitTest){var i=this.vrDisplay.hitTest(e,t);i&&i.length>0&&(this.visible=!0,V(this,i[0],this.applyOrientation,this.easing))}}}]),i}(t.Mesh),N="#define GLSLIFY 1\n// Copyright 2017 Google Inc. All Rights Reserved.\n// Licensed under the Apache License, Version 2.0 (the 'License');\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an 'AS IS' BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",G="// Copyright 2017 Google Inc. All Rights Reserved.\n// Licensed under the Apache License, Version 2.0 (the 'License');\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an 'AS IS' BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n#define GLSLIFY 1\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n",W=function(){function e(t,i){o(this,e),this.vrDisplay=t,this.gl=i,this.vrDisplay&&(this.passThroughCamera=t.getPassThroughCamera(),this.program=n(i,N,G)),i.useProgram(this.program),this.vertexPositionAttribute=i.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=i.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=i.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexPositionBuffer);var r=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(r);i.bufferData(i.ARRAY_BUFFER,s,i.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.textureCoordBuffer);var l=null;if(this.vrDisplay){var h=this.passThroughCamera.width/this.passThroughCamera.textureWidth,u=this.passThroughCamera.height/this.passThroughCamera.textureHeight;l=[[0,0,0,u,h,0,h,u],[h,0,0,0,h,u,0,u],[h,u,h,0,0,u,0,0],[0,u,h,u,0,0,h,0]]}else l=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var c=0;c<l.length;c++)this.f32TextureCoords.push(new Float32Array(l[c]));this.combinedOrientation=a(screen.orientation.angle,this.passThroughCamera.orientation),i.bufferData(i.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],i.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,i.bindBuffer(i.ARRAY_BUFFER,null),this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var f=[0,1,2,2,1,3],p=new Uint16Array(f);return i.bufferData(i.ELEMENT_ARRAY_BUFFER,p,i.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),this.texture=i.createTexture(),i.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return l(e,[{key:"render",value:function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.enableVertexAttribArray(this.vertexPositionAttribute),e.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordBuffer);var t=a(screen.orientation.angle,this.passThroughCamera.orientation);t!==this.combinedOrientation&&(this.combinedOrientation=t,e.bufferData(e.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],e.STATIC_DRAW)),e.enableVertexAttribArray(this.textureCoordAttribute),e.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,this.texture),e.texImage2D(e.TEXTURE_EXTERNAL_OES,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.passThroughCamera),e.uniform1i(this.samplerUniform,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,this.indexBuffer.numItems,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,null),e.disableVertexAttribArray(this.vertexPositionAttribute),e.disableVertexAttribArray(this.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(),Y=function(){function e(t,i){o(this,e),this.vrDisplay=t,D(this.vrDisplay)||(this.renderer=i,this.gl=i.context,this.videoRenderer=new W(t,this.gl),this._resetGLState(),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1))}return l(e,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){if(!D(this.vrDisplay)){var e=this.gl,t=window.devicePixelRatio,i=this.width*t,r=this.height*t;e.viewportWidth!==i&&(e.viewportWidth=i),e.viewportHeight!==r&&(e.viewportHeight=r),this.gl.viewport(0,0,e.viewportWidth,e.viewportHeight),this.videoRenderer.render(),this._resetGLState()}}},{key:"_resetGLState",value:function(){"function"==typeof this.renderer.resetGLState?this.renderer.resetGLState():this.renderer.state.reset()}}]),e}();!function(){if(window.webarSpeechRecognitionInstance){!function(e){e.listeners={},e.addEventListener=function(e,t){if(!t)return this;var i=this.listeners[e];return i||(this.listeners[e]=i=[]),i.indexOf(t)<0&&i.push(t),this},e.removeEventListener=function(e,t){if(!t)return this;var i=this.listeners[e];if(i){var r=i.indexOf(t);r>=0&&(this.listeners[e]=i.splice(r,1))}return this},e.callEventListeners=function(e,t){t||(t={target:this}),t.target||(t.target=this),t.type=e;var i="on"+e;"function"==typeof this[i]&&this[i](t);var r=this.listeners[e];if(r)for(var n=0;n<r.length;n++){var a=s(r[n]);"object"===a?r[n].handleEvent(t):"function"===a&&r[n](t)}return this}}(window.webarSpeechRecognitionInstance),window.webkitSpeechRecognition=function(){return window.webarSpeechRecognitionInstance}}}(),e.ARDebug=v,e.ARPerspectiveCamera=x,e.ARReticle=H,e.ARUtils=P,e.ARView=Y,Object.defineProperty(e,"__esModule",{value:!0})});
