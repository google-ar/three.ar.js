{"version":3,"file":"three.ar.js","sources":["../src/ARDebug.js","../src/ARPerspectiveCamera.js","../src/loaders/OBJLoader.js","../src/loaders/MTLLoader.js","../src/loaders.js","../src/ARUtils.js","../src/ARReticle.js","../src/ARView.js","../src/ARSpeechRecognition.js","../src/index.js"],"sourcesContent":["/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DEFAULTS = {\n  open: true,\n  showLastHit: true,\n  showPoseStatus: true,\n};\n\nconst SUCCESS_COLOR = '#00ff00';\nconst FAILURE_COLOR = '#ff0077';\n\n// A cache to store original native VRDisplay methods\n// since WebARonARKit does not provide a VRDisplay.prototype[method],\n// and assuming the first time ARDebug proxies a method is the\n// 'native' version, this caches the correct method if we proxy a method twice\nlet cachedVRDisplayMethods = new Map();\n\n/**\n * A throttle function to limit number of DOM writes\n * in the ARDebug view.\n *\n * @param {Function} fn\n * @param {number} timer\n * @param {Object} scope\n *\n * @return {Function}\n */\nfunction throttle(fn, timer, scope) {\n  let lastFired;\n  let timeout;\n\n  return (...args) => {\n    const current = +new Date();\n    let until;\n\n    if (lastFired) {\n      until = lastFired + timer - current;\n    }\n\n    if (until == undefined || until < 0) {\n      lastFired = current;\n      fn.apply(scope, args);\n    } else if (until >= 0) {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        lastFired = current;\n        fn.apply(scope, args);\n      }, until);\n    }\n  };\n}\n/**\n * Class for creating a mesh that fires raycasts and lerps\n * a 3D object along the surface\n */\nclass ARDebug {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {Object} config\n   * @param {boolean} config.open\n   * @param {boolean} config.showLastHit\n   * @param {boolean} config.showPoseStatus\n   */\n  constructor(vrDisplay, config={}) {\n    this.config = Object.assign({}, config, DEFAULTS);\n    this.vrDisplay = vrDisplay;\n\n    this._view = new ARDebugView({ open: this.config.open });\n\n    if (this.config.showLastHit && this.vrDisplay.hitTest) {\n      this._view.addRow('hit-test', new ARDebugHitTestRow(vrDisplay));\n    }\n\n    if (this.config.showPoseStatus && this.vrDisplay.getFrameData) {\n      this._view.addRow('pose-status', new ARDebugPoseRow(vrDisplay));\n    }\n  }\n\n  /**\n   * Opens the debug panel.\n   */\n  open() {\n    this._view.open();\n  }\n\n  /**\n   * Closes the debug panel.\n   */\n  close() {\n    this._view.close();\n  }\n\n  /**\n   * Returns the root DOM element for the panel.\n   *\n   * @return {HTMLElement}\n   */\n  getElement() {\n    return this._view.getElement();\n  }\n}\n\n/**\n * An implementation that interfaces with the DOM, used\n * by ARDebug\n */\nclass ARDebugView {\n  /**\n   * @param {Object} config\n   * @param {boolean} config.open\n   */\n  constructor(config={}) {\n    this.rows = new Map();\n\n    this.el = document.createElement('div');\n    this.el.style.backgroundColor = '#333';\n    this.el.style.padding = '5px';\n    this.el.style.fontFamily = 'Roboto, Ubuntu, Arial, sans-serif';\n    this.el.style.color = 'rgb(165, 165, 165)';\n    this.el.style.position = 'absolute';\n    this.el.style.right = '20px';\n    this.el.style.top = '0px';\n    this.el.style.width = '200px';\n    this.el.style.fontSize = '12px';\n    this.el.style.zIndex = 9999;\n\n    this._rowsEl = document.createElement('div');\n    this._rowsEl.style.transitionProperty = 'max-height';\n    this._rowsEl.style.transitionDuration = '0.5s';\n    this._rowsEl.style.transitionDelay = '0s';\n    this._rowsEl.style.transitionTimingFunction = 'ease-out';\n    this._rowsEl.style.overflow = 'hidden';\n\n    this._controls = document.createElement('div');\n    this._controls.style.fontSize = '13px';\n    this._controls.style.fontWeight = 'bold';\n    this._controls.style.paddingTop = '5px';\n    this._controls.style.textAlign = 'center';\n    this._controls.style.cursor = 'pointer';\n    this._controls.addEventListener('click', this.toggleControls.bind(this));\n\n    // Initialize the view as open or closed\n    config.open ? this.open() : this.close();\n\n    this.el.appendChild(this._rowsEl);\n    this.el.appendChild(this._controls);\n  }\n\n  /**\n   * Toggles between open and close modes.\n   */\n  toggleControls() {\n    if (this._isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  /**\n   * Opens the debugging panel.\n   */\n  open() {\n    // Use max-height with large value to transition\n    // to/from a non-specific height (like auto/100%)\n    // https://stackoverflow.com/a/8331169\n    // @TODO investigate a more complete solution with correct timing,\n    // via something like http://n12v.com/css-transition-to-from-auto/\n    this._rowsEl.style.maxHeight = '100px';\n    this._isOpen = true;\n    this._controls.textContent = 'Close ARDebug';\n    for (let [, row] of this.rows) {\n      row.enable();\n    }\n  }\n\n  /**\n   * Closes the debugging panel.\n   */\n  close() {\n    this._rowsEl.style.maxHeight = '0px';\n    this._isOpen = false;\n    this._controls.textContent = 'Open ARDebug';\n    for (let [, row] of this.rows) {\n      row.disable();\n    }\n  }\n\n  /**\n   * Returns the ARDebugView root element.\n   *\n   * @return {HTMLElement}\n   */\n  getElement() {\n    return this.el;\n  }\n\n  /**\n   * Adds a row to the ARDebugView.\n   *\n   * @param {string} id\n   * @param {ARDebugRow} row\n   */\n  addRow(id, row) {\n    this.rows.set(id, row);\n\n    if (this._isOpen) {\n      row.enable();\n    }\n\n    this._rowsEl.appendChild(row.getElement());\n  }\n}\n\n/**\n * A class that implements features being a row in the ARDebugView.\n */\nclass ARDebugRow {\n  /**\n   * @param {string} title\n   */\n  constructor(title) {\n    this.el = document.createElement('div');\n    this.el.style.width = '100%';\n    this.el.style.borderTop = '1px solid rgb(54, 54, 54)';\n    this.el.style.borderBottom = '1px solid #14171A';\n    this.el.style.position = 'relative';\n    this.el.style.padding = '3px 0px';\n    this.el.style.overflow = 'hidden';\n\n    this._titleEl = document.createElement('span');\n    this._titleEl.style.fontWeight = 'bold';\n    this._titleEl.textContent = title;\n\n    this._dataEl = document.createElement('span');\n    this._dataEl.style.position = 'absolute';\n    this._dataEl.style.left = '40px';\n\n    // Create a text element to update so we can avoid\n    // forced reflows when updating\n    // https://stackoverflow.com/a/17203046\n    this._dataElText = document.createTextNode('');\n    this._dataEl.appendChild(this._dataElText);\n\n    this.el.appendChild(this._titleEl);\n    this.el.appendChild(this._dataEl);\n\n    this.update = throttle(this.update, 500, this);\n  }\n\n  /**\n   * Enables the proxying and inspection functionality of\n   * this row. Should be implemented by child class.\n   */\n  enable() {\n    throw new Error('Implement in child class');\n  }\n\n  /**\n   * Disables the proxying and inspection functionality of\n   * this row. Should be implemented by child class.\n   */\n  disable() {\n    throw new Error('Implement in child class');\n  }\n\n  /**\n   * Returns the ARDebugRow's root element.\n   *\n   * @return {HTMLElement}\n   */\n  getElement() {\n    return this.el;\n  }\n\n  /**\n   * Updates the row's value.\n   *\n   * @param {string} value\n   * @param {boolean} isSuccess\n   */\n  update(value, isSuccess) {\n    this._dataElText.nodeValue = value;\n    this._dataEl.style.color = isSuccess ? SUCCESS_COLOR : FAILURE_COLOR;\n  }\n}\n\n/**\n * The ARDebugRow subclass for displaying hit information\n * by wrapping `vrDisplay.hitTest` and displaying the results.\n */\nclass ARDebugHitTestRow extends ARDebugRow {\n  /**\n   * @param {VRDisplay} vrDisplay\n   */\n  constructor(vrDisplay) {\n    super('Hit');\n    this.vrDisplay = vrDisplay;\n    this._onHitTest = this._onHitTest.bind(this);\n\n    // Store the native hit test, or proxy the native `hitTest` call with our own\n    this._nativeHitTest = cachedVRDisplayMethods.get('hitTest') || this.vrDisplay.hitTest;\n    cachedVRDisplayMethods.set('hitTest', this._nativeHitTest);\n\n    this._didPreviouslyHit = null;\n  }\n\n  /**\n   * Enables the tracking of hit test information.\n   */\n  enable() {\n    this.vrDisplay.hitTest = this._onHitTest;\n  }\n\n  /**\n   * Disables the tracking of hit test information.\n   */\n  disable() {\n    this.vrDisplay.hitTest = this._nativeHitTest;\n  }\n\n  /**\n   * @param {VRHit} hit\n   * @return {string}\n   */\n  _hitToString(hit) {\n    const mm = hit.modelMatrix;\n    return `${mm[12].toFixed(2)}, ${mm[13].toFixed(2)}, ${mm[14].toFixed(2)}`;\n  }\n\n  /**\n   * @param {number} x\n   * @param {number} y\n   * @return {VRHit?}\n   */\n  _onHitTest(x, y) {\n    const hits = this._nativeHitTest.call(this.vrDisplay, x, y);\n\n    const t = (parseInt(performance.now(), 10) / 1000).toFixed(1);\n    const didHit = hits && hits.length;\n\n    this.update(`${didHit ? this._hitToString(hits[0]) : 'MISS'} @ ${t}s`, didHit);\n    this._didPreviouslyHit = didHit;\n    return hits;\n  }\n}\n\n/**\n * The ARDebugRow subclass for displaying pose information\n * by wrapping `vrDisplay.getFrameData` and displaying the results.\n */\nclass ARDebugPoseRow extends ARDebugRow {\n  /**\n   * @param {VRDisplay} vrDisplay\n   */\n  constructor(vrDisplay) {\n    super('Pose');\n    this.vrDisplay = vrDisplay;\n    this._onGetFrameData = this._onGetFrameData.bind(this);\n\n    // Store the native hit test, or proxy the native `hitTest` call with our own\n    this._nativeGetFrameData = cachedVRDisplayMethods.get('getFrameData') ||\n                               this.vrDisplay.getFrameData;\n    cachedVRDisplayMethods.set('getFrameData', this._nativeGetFrameData);\n\n    this.update('Looking for position...');\n    this._initialPose = false;\n  }\n\n  /**\n   * Enables displaying and pulling getFrameData\n   */\n  enable() {\n    this.vrDisplay.getFrameData = this._onGetFrameData;\n  }\n\n  /**\n   * Disables displaying and pulling getFrameData\n   */\n  disable() {\n    this.vrDisplay.getFrameData = this._nativeGetFrameData;\n  }\n\n  /**\n   * @param {VRPose} pose\n   * @return {string}\n   */\n  _poseToString(pose) {\n    return `${pose[0].toFixed(2)}, ${pose[1].toFixed(2)}, ${pose[2].toFixed(2)}`;\n  }\n\n  /**\n   * Wrapper around getFrameData\n   *\n   * @param {VRFrameData} frameData\n   * @return {boolean}\n   */\n  _onGetFrameData(frameData) {\n    const results = this._nativeGetFrameData.call(this.vrDisplay, frameData);\n    const pose = frameData && frameData.pose && frameData.pose.position;\n    // Ensure we have a valid pose; while the pose SHOULD be null when not\n    // provided by the VRDisplay, on WebARonARCore, the xyz values of position\n    // are all 0 -- mark this as an invalid pose\n    const isValidPose = pose &&\n                        typeof pose[0] === 'number' &&\n                        typeof pose[1] === 'number' &&\n                        typeof pose[2] === 'number' &&\n                        !(pose[0] === 0 && pose[1] === 0 && pose[2] === 0);\n\n    // If we haven't received a pose yet, and still don't have a valid pose\n    // leave the message how it is\n    if (!this._initialPose && !isValidPose) {\n      return results;\n    }\n\n    if (isValidPose) {\n      this.update(this._poseToString(pose), true);\n    } else if (!isValidPose && this._lastPoseValid !== false) {\n      this.update(`Position lost`, false);\n    }\n\n    this._lastPoseValid = isValidPose;\n    this._initialPose = true;\n\n    return results;\n  }\n}\n\n\n// THREE.ARDebug = ARDebug;\nexport { ARDebug };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PerspectiveCamera } from 'three';\n\n// Reuse the frame data for getting the projection matrix\nlet frameData;\n\n/**\n * Class extending a THREE.PerspectiveCamera, attempting\n * to use the projection matrix provided from an AR-enabled\n * VRDisplay. If no AR-enabled VRDisplay found, uses provided\n * parameters.\n */\nclass ARPerspectiveCamera extends PerspectiveCamera {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {number} fov\n   * @param {number} aspect\n   * @param {number} near\n   * @param {number} far\n   */\n  constructor(vrDisplay, fov, aspect, near, far) {\n    super(fov, aspect, near, far);\n    this.isARPerpsectiveCamera = true;\n    this.vrDisplay = vrDisplay;\n    this.updateProjectionMatrix();\n\n    if (!vrDisplay || !vrDisplay.capabilities.hasPassThroughCamera) {\n      console.warn(`ARPerspectiveCamera does not a VRDisplay with\n                    a pass through camera. Using supplied values and defaults\n                    instead of device camera intrinsics`);\n    }\n  }\n\n  /**\n   * Updates the underlying `projectionMatrix` property from\n   * the AR-enabled VRDisplay, or falls back to\n   * THREE.PerspectiveCamera.prototype.updateProjectionMatrix\n   */\n  updateProjectionMatrix() {\n    const projMatrix = this.getProjectionMatrix();\n    if (!projMatrix) {\n      super.updateProjectionMatrix();\n      return;\n    }\n\n    this.projectionMatrix.fromArray(projMatrix);\n  }\n\n  /**\n   * Gets the projection matrix from AR-enabled VRDisplay\n   * if possible.\n   * @return {!Float32Array}\n   */\n  getProjectionMatrix() {\n    if (this.vrDisplay && this.vrDisplay.getFrameData) {\n      if (!frameData) {\n        frameData = new VRFrameData();\n      }\n      this.vrDisplay.getFrameData(frameData);\n\n      // Can use either left or right projection matrix\n      return frameData.leftProjectionMatrix;\n    }\n    return null;\n  }\n}\n\n\n// THREE.ARPerspectiveCamera = ARPerspectiveCamera;\nexport { ARPerspectiveCamera };\n","/**\n* @author mrdoob / http://mrdoob.com/\n*/\n\nimport {\n  DefaultLoadingManager,\n  FileLoader,\n  Group,\n  BufferGeometry,\n  BufferAttribute,\n  LineBasicMaterial,\n  MeshPhongMaterial,\n  Mesh,\n  LineSegments,\n} from 'three';\n\n// o object_name | g group_name\nconst object_pattern = /^[og]\\s*(.+)?/; //eslint-disable-line\n// mtllib file_reference\nconst material_library_pattern = /^mtllib /; //eslint-disable-line\n// usemtl material_name\nconst material_use_pattern = /^usemtl /; //eslint-disable-line\n\nconst ParserState = () => {\n  let state = {\n    objects: [],\n    object: {},\n\n    vertices: [],\n    normals: [],\n    uvs: [],\n\n    materialLibraries: [],\n\n    startObject: function(name, fromDeclaration) {\n      // If the current object (initial from reset) is not from a g/o declaration in the parsed\n      // file. We need to use it for the first parsed g/o to keep things in sync.\n      if (this.object && this.object.fromDeclaration === false) {\n        this.object.name = name;\n        this.object.fromDeclaration = (fromDeclaration !== false);\n        return;\n      }\n\n      let previousMaterial = (this.object && typeof this.object.currentMaterial === 'function'\n        ? this.object.currentMaterial()\n        : undefined);\n\n      if (this.object && typeof this.object._finalize === 'function') {\n        this.object._finalize(true);\n      }\n\n      this.object = {\n        name: name || '',\n        fromDeclaration: (fromDeclaration !== false),\n\n        geometry: {\n          vertices: [],\n          normals: [],\n          uvs: [],\n        },\n        materials: [],\n        smooth: true,\n\n        startMaterial: function(name, libraries) {\n          let previous = this._finalize(false);\n\n          // New usemtl declaration overwrites an inherited material, except if faces were declared\n          // after the material, then it must be preserved for proper MultiMaterial continuation.\n          if (previous && (previous.inherited || previous.groupCount <= 0)) {\n            this.materials.splice(previous.index, 1);\n          }\n\n          let material = {\n            index: this.materials.length,\n            name: name || '',\n            mtllib: (Array.isArray(libraries) && libraries.length > 0\n              ? libraries[libraries.length - 1]\n              : ''),\n            smooth: (previous !== undefined\n              ? previous.smooth\n              : this.smooth),\n            groupStart: (previous !== undefined\n              ? previous.groupEnd\n              : 0),\n            groupEnd: -1,\n            groupCount: -1,\n            inherited: false,\n\n            clone: function(index) {\n              let cloned = {\n                index: (typeof index === 'number'\n                  ? index\n                  : this.index),\n                name: this.name,\n                mtllib: this.mtllib,\n                smooth: this.smooth,\n                groupStart: 0,\n                groupEnd: -1,\n                groupCount: -1,\n                inherited: false,\n              };\n              cloned.clone = this.clone.bind(cloned);\n              return cloned;\n            },\n          };\n\n          this.materials.push(material);\n\n          return material;\n        },\n\n        currentMaterial: function() {\n          if (this.materials.length > 0) {\n            return this.materials[this.materials.length - 1];\n          }\n\n          return undefined;\n        },\n\n        _finalize: function(end) {\n          let lastMultiMaterial = this.currentMaterial();\n          if (lastMultiMaterial && lastMultiMaterial.groupEnd === -1) {\n            lastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\n            lastMultiMaterial.groupCount = lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart; //eslint-disable-line\n            lastMultiMaterial.inherited = false;\n          }\n\n          // Ignore objects tail materials if no face\n          // declarations followed them before a new o/g started.\n          if (end && this.materials.length > 1) {\n            for (let mi = this.materials.length - 1; mi >= 0; mi--) {\n              if (this.materials[mi].groupCount <= 0) {\n                this.materials.splice(mi, 1);\n              }\n            }\n          }\n\n          // Guarantee at least one empty material,\n          // this makes the creation later more straight forward.\n          if (end && this.materials.length === 0) {\n            this.materials.push({ name: '', smooth: this.smooth });\n          }\n\n          return lastMultiMaterial;\n        },\n      };\n\n      // Inherit previous objects material.\n      // Spec tells us that a declared material must be set to all objects until\n      // a new material is declared.\n      // If a usemtl declaration is encountered while this new object is being parsed, it will\n      // overwrite the inherited material. Exception being that there was already face declarations\n      // to the inherited material, then it will be preserved for proper MultiMaterial continuation.\n\n      if (previousMaterial && previousMaterial.name\n          && typeof previousMaterial.clone === 'function') {\n        let declared = previousMaterial.clone(0);\n        declared.inherited = true;\n        this.object.materials.push(declared);\n      }\n\n      this.objects.push(this.object);\n    },\n\n    finalize: function() {\n      if (this.object && typeof this.object._finalize === 'function') {\n        this.object._finalize(true);\n      }\n    },\n\n    parseVertexIndex: function(value, len) {\n      let index = parseInt(value, 10);\n      return (index >= 0\n        ? index - 1\n        : index + len / 3) * 3;\n    },\n\n    parseNormalIndex: function(value, len) {\n      let index = parseInt(value, 10);\n      return (index >= 0\n        ? index - 1\n        : index + len / 3) * 3;\n    },\n\n    parseUVIndex: function(value, len) {\n      let index = parseInt(value, 10);\n      return (index >= 0\n        ? index - 1\n        : index + len / 2) * 2;\n    },\n\n    addVertex: function(a, b, c) {\n      let src = this.vertices;\n      let dst = this.object.geometry.vertices;\n\n      dst.push(src[a + 0], src[a + 1], src[a + 2]);\n      dst.push(src[b + 0], src[b + 1], src[b + 2]);\n      dst.push(src[c + 0], src[c + 1], src[c + 2]);\n    },\n\n    addVertexLine: function(a) {\n      let src = this.vertices;\n      let dst = this.object.geometry.vertices;\n\n      dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    },\n\n    addNormal: function(a, b, c) {\n      let src = this.normals;\n      let dst = this.object.geometry.normals;\n\n      dst.push(src[a + 0], src[a + 1], src[a + 2]);\n      dst.push(src[b + 0], src[b + 1], src[b + 2]);\n      dst.push(src[c + 0], src[c + 1], src[c + 2]);\n    },\n\n    addUV: function(a, b, c) {\n      let src = this.uvs;\n      let dst = this.object.geometry.uvs;\n\n      dst.push(src[a + 0], src[a + 1]);\n      dst.push(src[b + 0], src[b + 1]);\n      dst.push(src[c + 0], src[c + 1]);\n    },\n\n    addUVLine: function(a) {\n      let src = this.uvs;\n      let dst = this.object.geometry.uvs;\n\n      dst.push(src[a + 0], src[a + 1]);\n    },\n\n    addFace: function(a, b, c, ua, ub, uc, na, nb, nc) {\n      let vLen = this.vertices.length;\n\n      let ia = this.parseVertexIndex(a, vLen);\n      let ib = this.parseVertexIndex(b, vLen);\n      let ic = this.parseVertexIndex(c, vLen);\n\n      this.addVertex(ia, ib, ic);\n\n      if (ua !== undefined) {\n        let uvLen = this.uvs.length;\n\n        ia = this.parseUVIndex(ua, uvLen);\n        ib = this.parseUVIndex(ub, uvLen);\n        ic = this.parseUVIndex(uc, uvLen);\n\n        this.addUV(ia, ib, ic);\n      }\n\n      if (na !== undefined) {\n        // Normals are many times the same. If so, skip function call and parseInt.\n        let nLen = this.normals.length;\n        ia = this.parseNormalIndex(na, nLen);\n\n        ib = na === nb\n          ? ia\n          : this.parseNormalIndex(nb, nLen);\n        ic = na === nc\n          ? ia\n          : this.parseNormalIndex(nc, nLen);\n\n        this.addNormal(ia, ib, ic);\n      }\n    },\n\n    addLineGeometry: function(vertices, uvs) {\n      this.object.geometry.type = 'Line';\n\n      let vLen = this.vertices.length;\n      let uvLen = this.uvs.length;\n\n      for (let vi = 0, l = vertices.length; vi < l; vi++) {\n        this.addVertexLine(this.parseVertexIndex(vertices[vi], vLen));\n      }\n\n      for (let uvi = 0, l = uvs.length; uvi < l; uvi++) {\n        this.addUVLine(this.parseUVIndex(uvs[uvi], uvLen));\n      }\n    },\n  };\n\n  state.startObject('', false);\n\n  return state;\n};\n\n/**\n* OBJLoader class\n* @type {Loader}\n*/\nexport default class OBJLoader {\n  /**\n* @param  {THREE.DefaultLoadingManager} manager\n*/\n  constructor(manager) {\n    this.manager = (manager !== undefined)\n      ? manager\n      : DefaultLoadingManager;\n\n    this.materials = null;\n  }\n\n  /**\n* @param  {String} url\n* @param  {Function} onLoad\n* @param  {Function} onProgress\n* @param  {Function} onError\n*/\n  load(url, onLoad, onProgress, onError) {\n    let scope = this;\n\n    let loader = new FileLoader(scope.manager);\n    loader.setPath(this.path);\n    loader.load(url, function(text) {\n      onLoad(scope.parse(text));\n    }, onProgress, onError);\n  }\n\n  /**\n* @param {String} value\n*/\n  setPath(value) {\n    this.path = value;\n  }\n\n  /**\n* @param {Object} materials\n* @return {OBJLoader} this\n*/\n  setMaterials(materials) {\n    this.materials = materials;\n\n    return this;\n  }\n\n  /**\n* @param  {String} text\n* @return {String}\n*/\n  parse(text) {\n    console.time('OBJLoader'); //eslint-disable-line\n\n    let state = new ParserState();\n\n    if (text.indexOf('\\r\\n') !== - 1) {\n      // This is faster than String.split with regex that splits on both\n      text = text.replace(/\\r\\n/g, '\\n');\n    }\n\n    if (text.indexOf('\\\\\\n') !== - 1) {\n      // join lines separated by a line continuation character (\\)\n      text = text.replace(/\\\\\\n/g, '');\n    }\n\n    let lines = text.split('\\n');\n    let line = '';\n    let lineFirstChar = '';\n    let lineLength = 0;\n    let result = [];\n\n    // Faster to just trim left side of the line. Use if available.\n    let trimLeft = (typeof ''.trimLeft === 'function');\n\n    for (let i = 0, l = lines.length; i < l; i++) {\n      line = lines[i];\n\n      line = trimLeft\n        ? line.trimLeft()\n        : line.trim();\n\n      lineLength = line.length;\n\n      if (lineLength === 0) {\n        continue;\n      }\n\n      lineFirstChar = line.charAt(0);\n\n      // @todo invoke passed in handler if any\n      if (lineFirstChar === '#') {\n        continue;\n      }\n\n      if (lineFirstChar === 'v') {\n        let data = line.split(/\\s+/);\n\n        switch (data[0]) {\n          case 'v':\n            state.vertices.push(parseFloat(data[1]), parseFloat(data[2]), parseFloat(data[3]));\n            break;\n          case 'vn':\n            state.normals.push(parseFloat(data[1]), parseFloat(data[2]), parseFloat(data[3]));\n            break;\n          case 'vt':\n            state.uvs.push(parseFloat(data[1]), parseFloat(data[2]));\n            break;\n        }\n      } else if (lineFirstChar === 'f') {\n        let lineData = line.substr(1).trim();\n        let vertexData = lineData.split(/\\s+/);\n        let faceVertices = [];\n\n        // Parse the face vertex data into an easy to work with format\n\n        for (let j = 0, jl = vertexData.length; j < jl; j++) {\n          let vertex = vertexData[j];\n\n          if (vertex.length > 0) {\n            let vertexParts = vertex.split('/');\n            faceVertices.push(vertexParts);\n          }\n        }\n\n        // Draw an edge between the first vertex and all subsequent vertices to form an n-gon\n\n        let v1 = faceVertices[0];\n\n        for (let j = 1, jl = faceVertices.length - 1; j < jl; j++) {\n          let v2 = faceVertices[j];\n          let v3 = faceVertices[j + 1];\n\n          state.addFace(v1[0], v2[0], v3[0], v1[1], v2[1], v3[1], v1[2], v2[2], v3[2]);\n        }\n      } else if (lineFirstChar === 'l') {\n        let lineParts = line.substring(1).trim().split(' ');\n        let lineVertices = [];\n        let lineUVs = [];\n\n        if (line.indexOf('/') === - 1) {\n          lineVertices = lineParts;\n        } else {\n          for (let li = 0, llen = lineParts.length; li < llen; li++) {\n            let parts = lineParts[li].split('/');\n\n            if (parts[0] !== '') {\n              lineVertices.push(parts[0]);\n            }\n            if (parts[1] !== '') {\n              lineUVs.push(parts[1]);\n            }\n          }\n        }\n        state.addLineGeometry(lineVertices, lineUVs);\n      } else if ((result = object_pattern.exec(line)) !== null) {\n        // o object_name\n        // or\n        // g group_name\n\n        // WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869\n        // var name = result[ 0 ].substr( 1 ).trim();\n        let name = (' ' + result[0].substr(1).trim()).substr(1);\n\n        state.startObject(name);\n      } else if (material_use_pattern.test(line)) {\n        // material\n\n        state.object.startMaterial(line.substring(7).trim(), state.materialLibraries);\n      } else if (material_library_pattern.test(line)) {\n        // mtl file\n\n        state.materialLibraries.push(line.substring(7).trim());\n      } else if (lineFirstChar === 's') {\n        result = line.split(' ');\n\n        // smooth shading\n\n        // @todo Handle files that have varying smooth values for a set of faces\n        // inside one geometry, but does not define a usemtl for each face set.\n        // This should be detected and a dummy material created\n        // (later MultiMaterial and geometry groups).\n        // This requires some care to not create extra material on each smooth\n        //  value for \"normal\" obj files.\n        // where explicit usemtl defines geometry groups.\n        // Example asset: examples/models/obj/cerberus/Cerberus.obj\n\n        /*\n* http://paulbourke.net/dataformats/obj/\n* or\n* http://www.cs.utah.edu/~boulos/cs3505/obj_spec.pdf\n*\n* From chapter \"Grouping\" Syntax explanation \"s group_number\":\n* \"group_number is the smoothing group number. To turn off smoothing\n*  groups, use a value of 0 or off.\n* Polygonal elements use group numbers to put elements in different\n*  smoothing groups. For free-form\n* surfaces, smoothing groups are either turned on or off; there is no\n*  difference between values greater\n* than 0.\"\n*/\n        if (result.length > 1) {\n          let value = result[1].trim().toLowerCase();\n          state.object.smooth = (value !== '0' && value !== 'off');\n        } else {\n          // ZBrush can produce \"s\" lines #11707\n          state.object.smooth = true;\n        }\n        let material = state.object.currentMaterial();\n        if (material) {\n          material.smooth = state.object.smooth;\n        } else {\n          // Handle null terminated files without exception\n          if (line === '\\0') {\n            continue;\n          }\n\n          throw new Error('Unexpected line: \\'' + line + '\\'');\n        }\n      }\n\n      state.finalize();\n\n      let container = new Group();\n      container.materialLibraries = [].concat(state.materialLibraries);\n\n      for (let i = 0, l = state.objects.length; i < l; i++) {\n        let object = state.objects[i];\n        let geometry = object.geometry;\n        let materials = object.materials;\n        let isLine = (geometry.type === 'Line');\n\n        // Skip o/g line declarations that did not follow with any faces\n        if (geometry.vertices.length === 0) {\n          continue;\n        }\n\n        let buffergeometry = new BufferGeometry();\n\n        buffergeometry.addAttribute('position',\n          new BufferAttribute(new Float32Array(geometry.vertices), 3));\n\n        if (geometry.normals.length > 0) {\n          buffergeometry.addAttribute('normal',\n            new BufferAttribute(new Float32Array(geometry.normals), 3));\n        } else {\n          buffergeometry.computeVertexNormals();\n        }\n\n        if (geometry.uvs.length > 0) {\n          buffergeometry.addAttribute('uv', new BufferAttribute(new Float32Array(geometry.uvs), 2));\n        }\n\n        // Create materials\n\n        let createdMaterials = [];\n\n        for (let mi = 0, miLen = materials.length; mi < miLen; mi++) {\n          let sourceMaterial = materials[mi];\n          let material = undefined;\n\n          if (this.materials !== null) {\n            material = this.materials.create(sourceMaterial.name);\n\n            // mtl etc. loaders probably can't create line materials correctly, \n            // copy properties to a line material.\n            if (isLine && material && !(material instanceof LineBasicMaterial)) {\n              let materialLine = new LineBasicMaterial();\n              materialLine.copy(material);\n              material = materialLine;\n            }\n          }\n\n          if (!material) {\n            material = (!isLine\n              ? new MeshPhongMaterial()\n              : new LineBasicMaterial());\n            material.name = sourceMaterial.name;\n          }\n\n          material.flatShading = sourceMaterial.smooth\n            ? false\n            : true;\n\n          createdMaterials.push(material);\n        }\n\n        // Create mesh\n\n        let mesh;\n\n        if (createdMaterials.length > 1) {\n          for (let mi = 0, miLen = materials.length; mi < miLen; mi++) {\n            let sourceMaterial = materials[mi];\n            buffergeometry.addGroup(sourceMaterial.groupStart, sourceMaterial.groupCount, mi);\n          }\n\n          mesh = (!isLine\n            ? new Mesh(buffergeometry, createdMaterials)\n            : new LineSegments(buffergeometry, createdMaterials));\n        } else {\n          mesh = (!isLine\n            ? new Mesh(buffergeometry, createdMaterials[0])\n            : new LineSegments(buffergeometry, createdMaterials[0]));\n        }\n\n        mesh.name = object.name;\n\n        container.add(mesh);\n      }\n\n      console.timeEnd('OBJLoader'); //eslint-disable-line\n\n      return container;\n    }\n  }\n}\n","import {\n  DefaultLoadingManager,\n  FileLoader,\n  FrontSide,\n  RepeatWrapping,\n  Color,\n  MeshPhongMaterial,\n  Vector2,\n  Loader,\n  TextureLoader,\n} from 'three';\n\n/**\n* Loads a Wavefront .mtl file specifying materials\n*\n* @author angelxuanchang\n*/\nexport default class MTLLoader {\n  /**\n* @param {THREE.DefaultLoadingManager} manager - the loading manager\n*/\n  constructor(manager) {\n    this.manager = (manager !== undefined)\n      ? manager\n      : DefaultLoadingManager;\n  }\n\n  /**\n* Loads and parses a MTL asset from a URL.\n*\n* @param {String} url - URL to the MTL file.\n* @param {Function} [onLoad] - Callback invoked with the loaded object.\n* @param {Function} [onProgress] - Callback for download progress.\n* @param {Function} [onError] - Callback for download errors.\n*\n* @see setPath setTexturePath\n*\n* @note In order for relative texture references to resolve correctly\n* you must call setPath and/or setTexturePath explicitly prior to load.\n*/\n  load(url, onLoad, onProgress, onError) {\n    let scope = this;\n\n    let loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.load(url, function(text) {\n      onLoad(scope.parse(text));\n    }, onProgress, onError);\n  }\n\n  /**\n* Set base path for resolving references.\n* If set this path will be prepended to each loaded and found reference.\n*\n* @see setTexturePath\n* @param {String} path\n*\n* @example\n*     mtlLoader.setPath( 'assets/obj/' );\n*     mtlLoader.load( 'my.mtl', ... );\n*/\n  setPath(path) {\n    this.path = path;\n  }\n\n  /**\n* Set base path for resolving texture references.\n* If set this path will be prepended found texture reference.\n* If not set and setPath is, it will be used as texture base path.\n*\n* @see setPath\n* @param {String} path\n*\n* @example\n*     mtlLoader.setPath( 'assets/obj/' );\n*     mtlLoader.setTexturePath( 'assets/textures/' );\n*     mtlLoader.load( 'my.mtl', ... );\n*/\n  setTexturePath(path) {\n    this.texturePath = path;\n  }\n\n  /**\n   * @param {String} path [description]\n   */\n  setBaseUrl(path) {\n    console.warn('MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.'); //eslint-disable-line\n    this.setTexturePath(path);\n  }\n\n  /**\n   * @param {String} value Set crossOrigin value\n   */\n  setCrossOrigin(value) {\n    this.crossOrigin = value;\n  }\n\n  /**\n   * @param {Object} value set material options\n   */\n  setMaterialOptions(value) {\n    this.materialOptions = value;\n  }\n\n  /**\n* Parses a MTL file.\n*\n* @param {String} text - Content of MTL file\n* @return {MTLLoader.MaterialCreator}\n*\n* @see setPath setTexturePath\n*\n* @note In order for relative texture references to resolve correctly\n* you must call setPath and/or setTexturePath explicitly prior to parse.\n*/\n  parse(text) {\n    let lines = text.split('\\n');\n    let info = {};\n    let delimiter_pattern = /\\s+/; //eslint-disable-line\n    let materialsInfo = {};\n\n    for (let i = 0; i < lines.length; i++) {\n      let line = lines[i];\n      line = line.trim();\n\n      if (line.length === 0 || line.charAt(0) === '#') {\n        // Blank line or comment ignore\n        continue;\n      }\n\n      let pos = line.indexOf(' ');\n\n      let key = (pos >= 0)\n        ? line.substring(0, pos)\n        : line;\n      key = key.toLowerCase();\n\n      let value = (pos >= 0)\n        ? line.substring(pos + 1)\n        : '';\n      value = value.trim();\n\n      if (key === 'newmtl') {\n        // New material\n\n        info = {\n          name: value,\n        };\n        materialsInfo[value] = info;\n      } else if (info) {\n        if (key === 'ka' || key === 'kd' || key === 'ks') {\n          let ss = value.split(delimiter_pattern, 3);\n          info[key] = [\n            parseFloat(ss[0]),\n            parseFloat(ss[1]),\n            parseFloat(ss[2]),\n          ];\n        } else {\n          info[key] = value;\n        }\n      }\n    }\n\n    let materialCreator = new MaterialCreator(this.texturePath || this.path, this.materialOptions);\n    materialCreator.setCrossOrigin(this.crossOrigin);\n    materialCreator.setManager(this.manager);\n    materialCreator.setMaterials(materialsInfo);\n    return materialCreator;\n  }\n}\n\n/**\n * Create a new THREE-MTLLoader.MaterialCreator\n * @type {Material}\n */\nclass MaterialCreator {\n  /**\n  * @param {String} baseUrl - Url relative to which textures are loaded\n  * @param {Object} options - Set of options on how to construct the materials\n  *                  side: Which side to apply the material\n  *                        FrontSide (default), BackSide, DoubleSide\n  *                  wrap: What type of wrapping to apply for textures\n  *                        RepeatWrapping (default), ClampToEdgeWrapping, MirroredRepeatWrapping\n  *                  normalizeRGB: RGBs need to be normalized to 0-1 from 0-255\n  *                                Default: false, assumed to be already normalized\n  *                  ignoreZeroRGBs: Ignore values of RGBs (Ka,Kd,Ks) that are all 0's\n  *                                  Default: false\n  * @constructor\n  */\n  constructor(baseUrl, options) {\n    this.baseUrl = baseUrl || '';\n    this.options = options;\n    this.materialsInfo = {};\n    this.materials = {};\n    this.materialsArray = [];\n    this.nameLookup = {};\n    this.crossOrigin = 'Anonymous';\n\n    this.side = (this.options && this.options.side)\n      ? this.options.side\n      : FrontSide;\n    this.wrap = (this.options && this.options.wrap)\n      ? this.options.wrap\n      : RepeatWrapping;\n  }\n\n  /**\n   * set cross origin\n   * @param {String} value cross origin value\n   */\n  setCrossOrigin(value) {\n    this.crossOrigin = value;\n  }\n\n  /**\n   * setManager\n   * @param {THREE.DefaultLoadingManager} value Loading manager\n   */\n  setManager(value) {\n    this.manager = value;\n  }\n\n  /**\n   * [setMaterials description]\n   * @param {Object} materialsInfo [description]\n   */\n  setMaterials(materialsInfo) {\n    this.materialsInfo = this.convert(materialsInfo);\n    this.materials = {};\n    this.materialsArray = [];\n    this.nameLookup = {};\n  }\n\n  /**\n   * [convert description]\n   * @param  {[type]} materialsInfo [description]\n   * @return {[type]}               [description]\n   */\n  convert(materialsInfo) {\n    if (!this.options) {\n      return materialsInfo;\n    }\n\n    let converted = {};\n\n    for (let mn in materialsInfo) {\n      if (materialsInfo[mn]) {\n      // Convert materials info into normalized form based on options\n\n        let mat = materialsInfo[mn];\n\n        let covmat = {};\n\n        converted[mn] = covmat;\n\n        for (let prop in mat) {\n          if (mat[prop]) {\n            let save = true;\n            let value = mat[prop];\n            let lprop = prop.toLowerCase();\n\n            switch (lprop) {\n              case 'kd':\n              case 'ka':\n              case 'ks':\n\n                // Diffuse color (color under white light) using RGB values\n\n                if (this.options && this.options.normalizeRGB) {\n                  value = [\n                    value[0] / 255,\n                    value[1] / 255,\n                    value[2] / 255,\n                  ];\n                }\n\n                if (this.options && this.options.ignoreZeroRGBs) {\n                  if (value[0] === 0 && value[1] === 0 && value[2] === 0) {\n                    // ignore\n\n                    save = false;\n                  }\n                }\n\n                break;\n\n              default:\n\n                break;\n            }\n\n            if (save) {\n              covmat[lprop] = value;\n            }\n          }\n        }\n      }\n    }\n\n    return converted;\n  }\n\n  /**\n   * preload\n   */\n  preload() {\n    for (let mn in this.materialsInfo) {\n      if (this.materialsInfo[mn]) {\n        this.create(mn);\n      }\n    }\n  }\n\n  /**\n   * get index\n   * @param  {String} materialName material name\n   * @return {Material}            return material\n   */\n  getIndex(materialName) {\n    return this.nameLookup[materialName];\n  }\n\n  /**\n   * getAsArray\n   * @return {Array} array\n   */\n  getAsArray() {\n    let index = 0;\n\n    for (let mn in this.materialsInfo) {\n      if (this.materialsInfo[mn]) {\n        this.materialsArray[index] = this.create(mn);\n        this.nameLookup[mn] = index;\n        index++;\n      }\n    }\n\n    return this.materialsArray;\n  }\n\n  /**\n   * create material\n   * @param  {String} materialName material name\n   * @return {Material}            returned material\n   */\n  create(materialName) {\n    if (this.materials[materialName] === undefined) {\n      this.createMaterial_(materialName);\n    }\n\n    return this.materials[materialName];\n  }\n\n  /**\n   * create material internal\n   * @param  {String} materialName material name\n   * @return {[type]}              [description]\n   */\n  createMaterial_(materialName) {\n    // Create material\n\n    let scope = this;\n    let mat = this.materialsInfo[materialName];\n    let params = {\n\n      name: materialName,\n      side: this.side,\n    };\n\n    const resolveURL =(baseUrl, url) => {\n      if (typeof url !== 'string' || url === '') {\n        return '';\n      }\n\n      // Absolute URL\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n\n      return baseUrl + url;\n    };\n\n    const setMapForType = (mapType, value) => {\n      if (params[mapType]) {\n        return;\n      } // Keep the first encountered texture\n\n      let texParams = scope.getTextureParams(value, params);\n      let map = scope.loadTexture(resolveURL(scope.baseUrl, texParams.url));\n\n      map.repeat.copy(texParams.scale);\n      map.offset.copy(texParams.offset);\n\n      map.wrapS = scope.wrap;\n      map.wrapT = scope.wrap;\n\n      params[mapType] = map;\n    };\n\n    for (let prop in mat) {\n      if (mat[prop]) {\n        let value = mat[prop];\n        let n;\n\n        if (value === '') {\n          continue;\n        }\n\n        switch (prop.toLowerCase()) {\n            // Ns is material specular exponent\n\n          case 'kd':\n\n            // Diffuse color (color under white light) using RGB values\n\n            params.color = new Color().fromArray(value);\n\n            break;\n\n          case 'ks':\n\n            // Specular color (color when light is reflected from shiny surface) using RGB values\n            params.specular = new Color().fromArray(value);\n\n            break;\n\n          case 'map_kd':\n\n            // Diffuse texture map\n\n            setMapForType('map', value);\n\n            break;\n\n          case 'map_ks':\n\n            // Specular map\n\n            setMapForType('specularMap', value);\n\n            break;\n\n          case 'norm':\n\n            setMapForType('normalMap', value);\n\n            break;\n\n          case 'map_bump':\n          case 'bump':\n\n            // Bump texture map\n\n            setMapForType('bumpMap', value);\n\n            break;\n\n          case 'ns':\n\n            // The specular exponent (defines the focus of the specular highlight)\n            // A high exponent results in a tight, concentrated highlight. \n            // Ns values normally range from 0 to 1000.\n\n            params.shininess = parseFloat(value);\n\n            break;\n\n          case 'd':\n            n = parseFloat(value);\n\n            if (n < 1) {\n              params.opacity = n;\n              params.transparent = true;\n            }\n\n            break;\n\n          case 'tr':\n            n = parseFloat(value);\n\n            if (n > 0) {\n              params.opacity = 1 - n;\n              params.transparent = true;\n            }\n\n            break;\n\n          default:\n            break;\n        }\n    }\n    }\n\n    this.materials[materialName] = new MeshPhongMaterial(params);\n    return this.materials[materialName];\n  }\n\n  /**\n   * getTextureParams\n   * @param  {String} value     \n   * @param  {[type]} matParams \n   * @return {[type]}           \n   */\n  getTextureParams(value, matParams) {\n    let texParams = {\n\n      scale: new Vector2(1, 1),\n      offset: new Vector2(0, 0),\n    };\n\n    let items = value.split(/\\s+/);\n    let pos;\n\n    pos = items.indexOf('-bm');\n\n    if (pos >= 0) {\n      matParams.bumpScale = parseFloat(items[pos + 1]);\n      items.splice(pos, 2);\n    }\n\n    pos = items.indexOf('-s');\n\n    if (pos >= 0) {\n      texParams.scale.set(parseFloat(items[pos + 1]), parseFloat(items[pos + 2]));\n      items.splice(pos, 4); // we expect 3 parameters here!\n    }\n\n    pos = items.indexOf('-o');\n\n    if (pos >= 0) {\n      texParams.offset.set(parseFloat(items[pos + 1]), parseFloat(items[pos + 2]));\n      items.splice(pos, 4); // we expect 3 parameters here!\n    }\n\n    texParams.url = items.join(' ').trim();\n    return texParams;\n  }\n\n  /**\n   * [loadTexture description]\n   * @param  {[type]} url        [description]\n   * @param  {[type]} mapping    [description]\n   * @param  {[type]} onLoad     [description]\n   * @param  {[type]} onProgress [description]\n   * @param  {[type]} onError    [description]\n   * @return {[type]}            [description]\n   */\n  loadTexture(url, mapping, onLoad, onProgress, onError) {\n    let texture;\n    let loader = Loader.Handlers.get(url);\n    let manager = (this.manager !== undefined)\n      ? this.manager\n      : DefaultLoadingManager;\n\n    if (loader === null) {\n      loader = new TextureLoader(manager);\n    }\n\n    if (loader.setCrossOrigin) {\nloader.setCrossOrigin(this.crossOrigin);\n}\n    texture = loader.load(url, onLoad, onProgress, onError);\n\n    if (mapping !== undefined) {\ntexture.mapping = mapping;\n}\n\n    return texture;\n  }\n}\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport OBJLoader from './loaders/OBJLoader';\nimport MTLLoader from './loaders/MTLLoader';\n\n/**\n * This module contains promisified loaders for internal use for\n * exposed ARUtils.\n */\n\nconst noop = function() {};\n\nexport const loadObj = (objPath, materials) => new Promise((resolve, reject) => {\n  const loader = new OBJLoader();\n\n  if (materials) {\n    loader.setMaterials(materials);\n  }\n\n  loader.load(objPath, resolve, noop, reject);\n});\n\nexport const loadMtl = mtlPath => new Promise((resolve, reject) => {\n  const loader = new MTLLoader();\n  const pathChunks = mtlPath.split('/');\n\n  if (pathChunks.length >= 2) {\n    loader.setTexturePath(pathChunks[pathChunks.length - 2]);\n  }\n\n  loader.load(mtlPath, resolve, noop, reject);\n});\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Matrix4,\n  Vector3,\n  Quaternion,\n  Math,\n} from 'three';\nimport { loadMtl, loadObj } from './loaders';\n\nconst LEARN_MORE_LINK = 'https://developers.google.com/ar/develop/web/getting-started';\nconst UNSUPPORTED_MESSAGE = `This augmented reality experience requires\n  WebARonARCore or WebARonARKit, experimental browsers from Google\n  for Android and iOS. Learn more at the <a href=\"${LEARN_MORE_LINK}\">Google Developers site</a>.`;\n\nconst ARUtils = {};\n\nARUtils.isTango = display =>\n  display && display.displayName.toLowerCase().includes('tango');\nexport const isTango = ARUtils.isTango;\n\nARUtils.isARKit = display =>\n  display && display.displayName.toLowerCase().includes('arkit');\nexport const isARKit = ARUtils.isARKit;\n\nARUtils.isARDisplay = display => isARKit(display) || isTango(display);\nexport const isARDisplay = ARUtils.isARDisplay;\n\n/**\n * Returns a promise that resolves to either to a VRDisplay with\n * AR capabilities, or null if no valid AR devices found on the platform.\n *\n * @return {Promise<VRDisplay?>}\n */\nARUtils.getARDisplay = () => new Promise((resolve, reject) => {\n  if (!navigator.getVRDisplays) {\n    resolve(null);\n    return;\n  }\n\n  navigator.getVRDisplays().then(displays => {\n    if (!displays && displays.length === 0) {\n      resolve(null);\n      return;\n    }\n\n    for (let display of displays) {\n      if (isARDisplay(display)) {\n        resolve(display);\n        return;\n      }\n    }\n    resolve(null);\n  });\n});\nexport const getARDisplay = ARUtils.getARDisplay;\n\n/**\n * Takes a path for an OBJ model and optionally a path for an MTL\n * texture and returns a promise resolving to a THREE.Mesh loaded with\n * the appropriate material. Can be used on downloaded models from Blocks.\n *\n * @param {string} objPath\n * @param {string} mtlPath\n * @return {THREE.Mesh}\n */\nARUtils.loadBlocksModel = (objPath, mtlPath) => new Promise((resolve, reject) => {\n  if (!THREE.OBJLoader || !THREE.MTLLoader) {\n    reject(new Error('Must include THREE.OBJLoader and THREE.MTLLoader'));\n    return;\n  }\n\n  let p = Promise.resolve();\n\n  if (mtlPath) {\n    p = loadMtl(mtlPath);\n  }\n\n  p.then(materials => {\n    if (materials) {\n      materials.preload();\n    }\n    return loadObj(objPath, materials);\n  }).then(obj => {\n    const model = obj.children[0];\n    model.geometry.applyMatrix(\n      new Matrix4().makeRotationY(Math.degToRad(-90))\n    );\n\n    return model;\n  }).then(resolve, reject);\n});\nexport const loadBlocksModel = ARUtils.loadBlocksModel;\n\nconst model = new Matrix4();\nconst tempPos = new Vector3();\nconst tempQuat = new Quaternion();\nconst tempScale = new Vector3();\n\n/**\n * Takes a THREE.Object3D and a VRHit and positions and optionally orients\n * the object according to the transform of the VRHit. Can provide an\n * easing value between 0 and 1 corresponding to the lerp between the\n * object's current position/orientation, and the position/orientation of the\n * hit.\n *\n * @param {THREE.Object3D} object\n * @param {VRHit} hit\n * @param {number} easing\n * @param {boolean} applyOrientation\n */\nARUtils.placeObjectAtHit = (object, hit, easing=1, applyOrientation=false) => {\n  if (!hit || !hit.modelMatrix) {\n    throw new Error('placeObjectAtHit requires a VRHit object');\n  }\n\n  model.fromArray(hit.modelMatrix);\n\n  model.decompose(tempPos, tempQuat, tempScale);\n\n  if (easing === 1) {\n    object.position.copy(tempPos);\n    if (applyOrientation) {\n      object.quaternion.copy(tempQuat);\n    }\n  } else {\n    object.position.lerp(tempPos, easing);\n    if (applyOrientation) {\n      object.quaternion.slerp(tempQuat, easing);\n    }\n  }\n};\nexport const placeObjectAtHit = ARUtils.placeObjectAtHit;\n\n/**\n * Injects a DOM element into the current page prompting the user that\n * their browser does not support these AR features.\n */\nARUtils.displayUnsupportedMessage = () => {\n  const element = document.createElement('div');\n  element.id = 'webgl-error-message';\n  element.style.fontFamily = 'monospace';\n  element.style.fontSize = '13px';\n  element.style.fontWeight = 'normal';\n  element.style.textAlign = 'center';\n  element.style.background = '#fff';\n  element.style.border = '1px solid black';\n  element.style.color = '#000';\n  element.style.padding = '1.5em';\n  element.style.width = '400px';\n  element.style.margin = '5em auto 0';\n  element.innerHTML = UNSUPPORTED_MESSAGE;\n  document.body.appendChild(element);\n};\nexport const displayUnsupportedMessage = ARUtils.displayUnsupportedMessage;\n\n\nexport { ARUtils };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Mesh,\n  Vector3,\n  RingGeometry,\n  MeshBasicMaterial,\n  Matrix4,\n  Math,\n} from 'three';\nimport { placeObjectAtHit } from './ARUtils';\n\n/**\n * Class for creating a mesh that fires raycasts and lerps\n * a 3D object along the surface\n */\nclass ARReticle extends Mesh {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {number} innerRadius\n   * @param {number} outerRadius\n   * @param {number} color\n   * @param {number} easing\n   */\n  constructor(\n    vrDisplay,\n    innerRadius = 0.02,\n    outerRadius = 0.05,\n    color = 0xff0077,\n    easing = 0.25\n  ) {\n    const geometry = new RingGeometry(innerRadius, outerRadius, 36, 64);\n    const material = new MeshBasicMaterial({ color });\n\n    // Orient the geometry so it's position is flat on a horizontal surface\n    geometry.applyMatrix(new Matrix4().makeRotationX(Math.degToRad(-90)));\n\n    super(geometry, material);\n    this.visible = false;\n\n    this.easing = easing;\n    this.applyOrientation = true;\n    this.vrDisplay = vrDisplay;\n    this._planeDir = new Vector3();\n  }\n\n  /**\n   * Attempt to fire a raycast from normalized screen coordinates\n   * x and y and lerp the reticle to the position.\n   *\n   * @param {number} x\n   * @param {number} y\n   */\n  update(x = 0.5, y = 0.5) {\n    if (!this.vrDisplay || !this.vrDisplay.hitTest) {\n      return;\n    }\n\n    const hit = this.vrDisplay.hitTest(x, y);\n    if (hit && hit.length > 0) {\n      this.visible = true;\n      placeObjectAtHit(this, hit[0], this.applyOrientation, this.easing);\n    }\n  }\n}\n\n\n// THREE.ARReticle = ARReticle;\nexport { ARReticle };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isARKit } from './ARUtils';\nimport vertexSource from './shaders/arview.vert';\nimport fragmentSource from './shaders/arview.frag';\n\n/**\n * Creates and load a shader from a string, type specifies either 'vertex' or 'fragment'\n *\n * @param {WebGLRenderingContext} gl\n * @param {string} str\n * @param {string} type\n * @return {!WebGLShader}\n */\nfunction getShader(gl, str, type) {\n  let shader;\n  if (type == 'fragment') {\n    shader = gl.createShader(gl.FRAGMENT_SHADER);\n  } else if (type == 'vertex') {\n    shader = gl.createShader(gl.VERTEX_SHADER);\n  } else {\n    return null;\n  }\n\n  gl.shaderSource(shader, str);\n  gl.compileShader(shader);\n\n  const result = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (!result) {\n    alert(gl.getShaderInfoLog(shader));\n    return null;\n  }\n\n  return shader;\n}\n\n/**\n * Creates a shader program from vertex and fragment shader sources\n *\n * @param {WebGLRenderingContext} gl\n * @param {string} vs\n * @param {string} fs\n * @return {!WebGLProgram}\n */\nfunction getProgram(gl, vs, fs) {\n  const vertexShader = getShader(gl, vs, 'vertex');\n  const fragmentShader = getShader(gl, fs, 'fragment');\n  if (!fragmentShader) {\n    return null;\n  }\n\n  const shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertexShader);\n  gl.attachShader(shaderProgram, fragmentShader);\n  gl.linkProgram(shaderProgram);\n\n  const result = gl.getProgramParameter(shaderProgram, gl.LINK_STATUS);\n  if (!result) {\n    alert('Could not initialise arview shaders');\n  }\n\n  return shaderProgram;\n}\n\n/**\n * Calculate the correct orientation depending on the device and the camera\n * orientations.\n *\n * @param {number} screenOrientation\n * @param {number} seeThroughCameraOrientation\n * @return {number}\n */\nfunction combineOrientations(screenOrientation, seeThroughCameraOrientation) {\n  let seeThroughCameraOrientationIndex = 0;\n  switch (seeThroughCameraOrientation) {\n    case 90:\n      seeThroughCameraOrientationIndex = 1;\n      break;\n    case 180:\n      seeThroughCameraOrientationIndex = 2;\n      break;\n    case 270:\n      seeThroughCameraOrientationIndex = 3;\n      break;\n    default:\n      seeThroughCameraOrientationIndex = 0;\n      break;\n  }\n  let screenOrientationIndex = 0;\n  switch (screenOrientation) {\n    case 90:\n      screenOrientationIndex = 1;\n      break;\n    case 180:\n      screenOrientationIndex = 2;\n      break;\n    case 270:\n      screenOrientationIndex = 3;\n      break;\n    default:\n      screenOrientationIndex = 0;\n      break;\n  }\n  let ret = screenOrientationIndex - seeThroughCameraOrientationIndex;\n  if (ret < 0) {\n    ret += 4;\n  }\n  return ret % 4;\n}\n\n/**\n * Renders the ar camera's video texture\n */\nclass ARVideoRenderer {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {WebGLRenderingContext} gl\n   */\n  constructor(vrDisplay, gl) {\n    this.vrDisplay = vrDisplay;\n    this.gl = gl;\n    if (this.vrDisplay) {\n      this.passThroughCamera = vrDisplay.getPassThroughCamera();\n      this.program = getProgram(gl, vertexSource, fragmentSource);\n    }\n\n    gl.useProgram(this.program);\n\n    // Setup a quad\n    this.vertexPositionAttribute = gl.getAttribLocation(\n      this.program,\n      'aVertexPosition'\n    );\n    this.textureCoordAttribute = gl.getAttribLocation(\n      this.program,\n      'aTextureCoord'\n    );\n\n    this.samplerUniform = gl.getUniformLocation(this.program, 'uSampler');\n\n    this.vertexPositionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBuffer);\n    let vertices = [\n      -1.0,\n      1.0,\n      0.0,\n      -1.0,\n      -1.0,\n      0.0,\n      1.0,\n      1.0,\n      0.0,\n      1.0,\n      -1.0,\n      0.0,\n    ];\n    let f32Vertices = new Float32Array(vertices);\n    gl.bufferData(gl.ARRAY_BUFFER, f32Vertices, gl.STATIC_DRAW);\n    this.vertexPositionBuffer.itemSize = 3;\n    this.vertexPositionBuffer.numItems = 12;\n\n    this.textureCoordBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.textureCoordBuffer);\n    // Precalculate different texture UV coordinates depending on the possible\n    // orientations of the device depending if there is a VRDisplay or not\n    let textureCoords = null;\n    if (this.vrDisplay) {\n      let u =\n        this.passThroughCamera.width / this.passThroughCamera.textureWidth;\n      let v =\n        this.passThroughCamera.height / this.passThroughCamera.textureHeight;\n      textureCoords = [\n        [0.0, 0.0, 0.0, v, u, 0.0, u, v],\n        [u, 0.0, 0.0, 0.0, u, v, 0.0, v],\n        [u, v, u, 0.0, 0.0, v, 0.0, 0.0],\n        [0.0, v, u, v, 0.0, 0.0, u, 0.0],\n      ];\n    } else {\n      textureCoords = [\n        [0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0],\n        [1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0],\n        [1.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0],\n        [0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0],\n      ];\n    }\n\n    this.f32TextureCoords = [];\n    for (let i = 0; i < textureCoords.length; i++) {\n      this.f32TextureCoords.push(new Float32Array(textureCoords[i]));\n    }\n    // Store the current combined orientation to check if it has changed\n    // during the update calls and use the correct texture coordinates.\n    this.combinedOrientation = combineOrientations(\n      screen.orientation.angle,\n      this.passThroughCamera.orientation\n    );\n\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      this.f32TextureCoords[this.combinedOrientation],\n      gl.STATIC_DRAW\n    );\n    this.textureCoordBuffer.itemSize = 2;\n    this.textureCoordBuffer.numItems = 8;\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n    this.indexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    let indices = [0, 1, 2, 2, 1, 3];\n    let ui16Indices = new Uint16Array(indices);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, ui16Indices, gl.STATIC_DRAW);\n    this.indexBuffer.itemSize = 1;\n    this.indexBuffer.numItems = 6;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n    this.texture = gl.createTexture();\n    gl.useProgram(null);\n\n    // The projection matrix will be based on an identify orthographic camera\n    this.projectionMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    this.mvMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    return this;\n  }\n\n  /**\n   * Renders the quad\n   */\n  render() {\n    let gl = this.gl;\n    gl.useProgram(this.program);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBuffer);\n    gl.enableVertexAttribArray(this.vertexPositionAttribute);\n    gl.vertexAttribPointer(\n      this.vertexPositionAttribute,\n      this.vertexPositionBuffer.itemSize,\n      gl.FLOAT,\n      false,\n      0,\n      0\n    );\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.textureCoordBuffer);\n\n    // Check the current orientation of the device combined with the\n    // orientation of the VRSeeThroughCamera to determine the correct UV\n    // coordinates to be used.\n    let combinedOrientation = combineOrientations(\n      screen.orientation.angle,\n      this.passThroughCamera.orientation\n    );\n    if (combinedOrientation !== this.combinedOrientation) {\n      this.combinedOrientation = combinedOrientation;\n      gl.bufferData(\n        gl.ARRAY_BUFFER,\n        this.f32TextureCoords[this.combinedOrientation],\n        gl.STATIC_DRAW\n      );\n    }\n    gl.enableVertexAttribArray(this.textureCoordAttribute);\n    gl.vertexAttribPointer(\n      this.textureCoordAttribute,\n      this.textureCoordBuffer.itemSize,\n      gl.FLOAT,\n      false,\n      0,\n      0\n    );\n\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_EXTERNAL_OES, this.texture);\n    // Update the content of the texture in every frame.\n    gl.texImage2D(\n      gl.TEXTURE_EXTERNAL_OES,\n      0,\n      gl.RGB,\n      gl.RGB,\n      gl.UNSIGNED_BYTE,\n      this.passThroughCamera\n    );\n    gl.uniform1i(this.samplerUniform, 0);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    gl.drawElements(\n      gl.TRIANGLES,\n      this.indexBuffer.numItems,\n      gl.UNSIGNED_SHORT,\n      0\n    );\n\n    // Disable enabled states to allow other render calls to correctly work\n    gl.bindTexture(gl.TEXTURE_EXTERNAL_OES, null);\n    gl.disableVertexAttribArray(this.vertexPositionAttribute);\n    gl.disableVertexAttribArray(this.textureCoordAttribute);\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    gl.useProgram(null);\n  }\n}\n\n/**\n * A helper class that takes a VRDisplay with AR capabilities\n * and renders the see through camera to the passed in WebGLRenderer's\n * context.\n */\nclass ARView {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {THREE.WebGLRenderer} renderer\n   */\n  constructor(vrDisplay, renderer) {\n    this.vrDisplay = vrDisplay;\n    if (isARKit(this.vrDisplay)) {\n      return;\n    }\n    this.renderer = renderer;\n    this.gl = renderer.context;\n\n    this.videoRenderer = new ARVideoRenderer(vrDisplay, this.gl);\n    this._resetGLState();\n\n    // Cache the width/height so we're not potentially forcing\n    // a reflow if there's been a style invalidation\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n    window.addEventListener('resize', this.onWindowResize.bind(this), false);\n  }\n\n  /**\n   * Updates the stored width/height of window on resize.\n   */\n  onWindowResize() {\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n  }\n\n  /**\n   * Renders the see through camera to the passed in renderer\n   */\n  render() {\n    if (isARKit(this.vrDisplay)) {\n      return;\n    }\n\n    let gl = this.gl;\n    let dpr = window.devicePixelRatio;\n    let width = this.width * dpr;\n    let height = this.height * dpr;\n\n    if (gl.viewportWidth !== width) {\n      gl.viewportWidth = width;\n    }\n\n    if (gl.viewportHeight !== height) {\n      gl.viewportHeight = height;\n    }\n\n    this.gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);\n    this.videoRenderer.render();\n    this._resetGLState();\n  }\n\n  /**\n   * Resets the GL state in the THREE.WebGLRenderer.\n   */\n  _resetGLState() {\n    if (typeof this.renderer.resetGLState === 'function') {\n      // If using three.js <= r86\n      this.renderer.resetGLState();\n    } else {\n      // If using three.js >= r87\n      this.renderer.state.reset();\n    }\n  }\n}\n\n\n// THREE.ARView = ARView;\nexport { ARView };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /* eslint-disable */\n(function() {\n  if (window.webarSpeechRecognitionInstance) {\n\n    function addEventHandlingToObject(object) {\n      object.listeners = { };\n      object.addEventListener = function(eventType, callback) {\n        if (!callback) {\n          return this;\n        }\n        var listeners = this.listeners[eventType];\n        if (!listeners) {\n          this.listeners[eventType] = listeners = [];\n        }\n        if (listeners.indexOf(callback) < 0) {\n          listeners.push(callback);\n        }\n        return this;\n      };\n      object.removeEventListener = function(eventType, callback) {\n        if (!callback) {\n          return this;\n        }\n        var listeners = this.listeners[eventType];\n        if (listeners) {\n          var i = listeners.indexOf(callback);\n          if (i >= 0) {\n            this.listeners[eventType] = listeners.splice(i, 1);\n          }\n        }\n        return this;\n      };\n      object.callEventListeners = function(eventType, event) {\n        if (!event) {\n          event = { target : this };\n        }\n        if (!event.target) {\n          event.target = this;\n        }\n        event.type = eventType;\n        var onEventType = 'on' + eventType;\n        if (typeof(this[onEventType]) === 'function') {\n          this[onEventType](event)\n        }\n        var listeners = this.listeners[eventType];\n        if (listeners) {\n          for (var i = 0; i < listeners.length; i++) {\n            var typeofListener = typeof(listeners[i]);\n            if (typeofListener === 'object') {\n              listeners[i].handleEvent(event);\n            }\n            else if (typeofListener === 'function') {\n              listeners[i](event);\n            }\n          }\n        }\n        return this;\n      };\n    } \n\n    addEventHandlingToObject(window.webarSpeechRecognitionInstance);\n    var originalWebKitSpeechRecognition = window.webkitSpeechRecognition;\n    window.webkitSpeechRecognition = function() {\n      return window.webarSpeechRecognitionInstance;\n    };\n  }\n})();\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint no-unused-vars: \"off\" */\n\nexport { ARDebug } from './ARDebug';\nexport { ARPerspectiveCamera } from './ARPerspectiveCamera';\nexport { ARReticle } from './ARReticle';\nexport { ARUtils } from './ARUtils';\nexport { ARView } from './ARView';\nimport './ARSpeechRecognition';\n"],"names":["DEFAULTS","open","showLastHit","showPoseStatus","SUCCESS_COLOR","FAILURE_COLOR","cachedVRDisplayMethods","Map","throttle","fn","timer","scope","lastFired","timeout","args","current","Date","until","undefined","apply","clearTimeout","setTimeout","ARDebug","vrDisplay","config","Object","assign","_view","ARDebugView","hitTest","addRow","ARDebugHitTestRow","getFrameData","ARDebugPoseRow","close","getElement","rows","el","document","createElement","style","backgroundColor","padding","fontFamily","color","position","right","top","width","fontSize","zIndex","_rowsEl","transitionProperty","transitionDuration","transitionDelay","transitionTimingFunction","overflow","_controls","fontWeight","paddingTop","textAlign","cursor","addEventListener","toggleControls","bind","appendChild","_isOpen","maxHeight","textContent","row","enable","disable","id","set","ARDebugRow","title","borderTop","borderBottom","_titleEl","_dataEl","left","_dataElText","createTextNode","update","Error","value","isSuccess","nodeValue","_onHitTest","_nativeHitTest","get","_didPreviouslyHit","hit","mm","modelMatrix","toFixed","x","y","hits","call","t","parseInt","performance","now","didHit","length","_hitToString","_onGetFrameData","_nativeGetFrameData","_initialPose","pose","frameData","results","isValidPose","_poseToString","_lastPoseValid","ARPerspectiveCamera","fov","aspect","near","far","isARPerpsectiveCamera","updateProjectionMatrix","capabilities","hasPassThroughCamera","console","warn","projMatrix","getProjectionMatrix","projectionMatrix","fromArray","VRFrameData","leftProjectionMatrix","PerspectiveCamera","object_pattern","material_library_pattern","material_use_pattern","ParserState","state","objects","object","vertices","normals","uvs","materialLibraries","startObject","name","fromDeclaration","previousMaterial","currentMaterial","_finalize","geometry","materials","smooth","startMaterial","libraries","previous","inherited","groupCount","splice","index","material","mtllib","Array","isArray","groupStart","groupEnd","clone","cloned","push","end","lastMultiMaterial","mi","declared","finalize","parseVertexIndex","len","parseNormalIndex","parseUVIndex","addVertex","a","b","c","src","dst","addVertexLine","addNormal","addUV","addUVLine","addFace","ua","ub","uc","na","nb","nc","vLen","ia","ib","ic","uvLen","nLen","addLineGeometry","type","vi","l","uvi","OBJLoader","manager","DefaultLoadingManager","url","onLoad","onProgress","onError","loader","FileLoader","setPath","path","load","text","parse","time","indexOf","replace","lines","split","line","lineFirstChar","lineLength","result","trimLeft","i","trim","charAt","data","parseFloat","lineData","substr","vertexData","faceVertices","j","jl","vertex","vertexParts","v1","v2","v3","lineParts","substring","lineVertices","lineUVs","li","llen","parts","exec","test","toLowerCase","container","Group","concat","isLine","buffergeometry","BufferGeometry","addAttribute","BufferAttribute","Float32Array","computeVertexNormals","createdMaterials","miLen","sourceMaterial","create","LineBasicMaterial","materialLine","copy","MeshPhongMaterial","flatShading","mesh","addGroup","Mesh","LineSegments","add","timeEnd","MTLLoader","texturePath","setTexturePath","crossOrigin","materialOptions","info","delimiter_pattern","materialsInfo","pos","key","ss","materialCreator","MaterialCreator","setCrossOrigin","setManager","setMaterials","baseUrl","options","materialsArray","nameLookup","side","FrontSide","wrap","RepeatWrapping","convert","converted","mn","mat","covmat","prop","save","lprop","normalizeRGB","ignoreZeroRGBs","materialName","createMaterial_","params","resolveURL","setMapForType","mapType","texParams","getTextureParams","map","loadTexture","repeat","scale","offset","wrapS","wrapT","n","Color","specular","shininess","opacity","transparent","matParams","Vector2","items","bumpScale","join","mapping","texture","Loader","Handlers","TextureLoader","noop","loadObj","objPath","Promise","resolve","reject","loadMtl","pathChunks","mtlPath","LEARN_MORE_LINK","UNSUPPORTED_MESSAGE","ARUtils","isTango","display","displayName","includes","isARKit","isARDisplay","getARDisplay","navigator","getVRDisplays","then","displays","loadBlocksModel","THREE","p","preload","model","obj","children","applyMatrix","Matrix4","makeRotationY","Math","degToRad","tempPos","Vector3","tempQuat","Quaternion","tempScale","placeObjectAtHit","easing","applyOrientation","decompose","quaternion","lerp","slerp","displayUnsupportedMessage","element","background","border","margin","innerHTML","body","ARReticle","innerRadius","outerRadius","RingGeometry","MeshBasicMaterial","makeRotationX","visible","_planeDir","getShader","gl","str","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","alert","getShaderInfoLog","getProgram","vs","fs","vertexShader","fragmentShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","combineOrientations","screenOrientation","seeThroughCameraOrientation","seeThroughCameraOrientationIndex","screenOrientationIndex","ret","ARVideoRenderer","passThroughCamera","getPassThroughCamera","program","vertexSource","fragmentSource","useProgram","vertexPositionAttribute","getAttribLocation","textureCoordAttribute","samplerUniform","getUniformLocation","vertexPositionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","f32Vertices","bufferData","STATIC_DRAW","itemSize","numItems","textureCoordBuffer","textureCoords","u","textureWidth","v","height","textureHeight","f32TextureCoords","combinedOrientation","screen","orientation","angle","indexBuffer","ELEMENT_ARRAY_BUFFER","indices","ui16Indices","Uint16Array","createTexture","mvMatrix","enableVertexAttribArray","vertexAttribPointer","FLOAT","activeTexture","TEXTURE0","bindTexture","TEXTURE_EXTERNAL_OES","texImage2D","RGB","UNSIGNED_BYTE","uniform1i","drawElements","TRIANGLES","UNSIGNED_SHORT","disableVertexAttribArray","ARView","renderer","context","videoRenderer","_resetGLState","window","innerWidth","innerHeight","onWindowResize","dpr","devicePixelRatio","viewportWidth","viewportHeight","viewport","render","resetGLState","reset","webarSpeechRecognitionInstance","addEventHandlingToObject","listeners","eventType","callback","removeEventListener","callEventListeners","event","target","onEventType","typeofListener","handleEvent","webkitSpeechRecognition"],"mappings":"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"}