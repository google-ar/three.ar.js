{"version":3,"file":"three.ar.js","sources":["../src/ARDebug.js","../src/ARPerspectiveCamera.js","../src/loaders.js","../src/ARUtils.js","../src/ARReticle.js","../src/ARView.js","../src/ARSpeechRecognition.js","../src/index.js"],"sourcesContent":["/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DEFAULTS = {\n  open: true,\n  showLastHit: true,\n  showPoseStatus: true,\n};\n\nconst SUCCESS_COLOR = '#00ff00';\nconst FAILURE_COLOR = '#ff0077';\n\n// A cache to store original native VRDisplay methods\n// since WebARonARKit does not provide a VRDisplay.prototype[method],\n// and assuming the first time ARDebug proxies a method is the\n// 'native' version, this caches the correct method if we proxy a method twice\nlet cachedVRDisplayMethods = new Map();\n\n/**\n * A throttle function to limit number of DOM writes\n * in the ARDebug view.\n *\n * @param {Function} fn\n * @param {number} timer\n * @param {Object} scope\n *\n * @return {Function}\n */\nfunction throttle(fn, timer, scope) {\n  let lastFired;\n  let timeout;\n\n  return (...args) => {\n    const current = +new Date();\n    let until;\n\n    if (lastFired) {\n      until = lastFired + timer - current;\n    }\n\n    if (until == undefined || until < 0) {\n      lastFired = current;\n      fn.apply(scope, args);\n    } else if (until >= 0) {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        lastFired = current;\n        fn.apply(scope, args);\n      }, until);\n    }\n  };\n}\n/**\n * Class for creating a mesh that fires raycasts and lerps\n * a 3D object along the surface\n */\nclass ARDebug {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {Object} config\n   * @param {boolean} config.open\n   * @param {boolean} config.showLastHit\n   * @param {boolean} config.showPoseStatus\n   */\n  constructor(vrDisplay, config={}) {\n    this.config = Object.assign({}, config, DEFAULTS);\n    this.vrDisplay = vrDisplay;\n\n    this._view = new ARDebugView({ open: this.config.open });\n\n    if (this.config.showLastHit && this.vrDisplay.hitTest) {\n      this._view.addRow('hit-test', new ARDebugHitTestRow(vrDisplay));\n    }\n\n    if (this.config.showPoseStatus && this.vrDisplay.getFrameData) {\n      this._view.addRow('pose-status', new ARDebugPoseRow(vrDisplay));\n    }\n  }\n\n  /**\n   * Opens the debug panel.\n   */\n  open() {\n    this._view.open();\n  }\n\n  /**\n   * Closes the debug panel.\n   */\n  close() {\n    this._view.close();\n  }\n\n  /**\n   * Returns the root DOM element for the panel.\n   *\n   * @return {HTMLElement}\n   */\n  getElement() {\n    return this._view.getElement();\n  }\n}\n\n/**\n * An implementation that interfaces with the DOM, used\n * by ARDebug\n */\nclass ARDebugView {\n  /**\n   * @param {Object} config\n   * @param {boolean} config.open\n   */\n  constructor(config={}) {\n    this.rows = new Map();\n\n    this.el = document.createElement('div');\n    this.el.style.backgroundColor = '#333';\n    this.el.style.padding = '5px';\n    this.el.style.fontFamily = 'Roboto, Ubuntu, Arial, sans-serif';\n    this.el.style.color = 'rgb(165, 165, 165)';\n    this.el.style.position = 'absolute';\n    this.el.style.right = '20px';\n    this.el.style.top = '0px';\n    this.el.style.width = '200px';\n    this.el.style.fontSize = '12px';\n    this.el.style.zIndex = 9999;\n\n    this._rowsEl = document.createElement('div');\n    this._rowsEl.style.transitionProperty = 'max-height';\n    this._rowsEl.style.transitionDuration = '0.5s';\n    this._rowsEl.style.transitionDelay = '0s';\n    this._rowsEl.style.transitionTimingFunction = 'ease-out';\n    this._rowsEl.style.overflow = 'hidden';\n\n    this._controls = document.createElement('div');\n    this._controls.style.fontSize = '13px';\n    this._controls.style.fontWeight = 'bold';\n    this._controls.style.paddingTop = '5px';\n    this._controls.style.textAlign = 'center';\n    this._controls.style.cursor = 'pointer';\n    this._controls.addEventListener('click', this.toggleControls.bind(this));\n\n    // Initialize the view as open or closed\n    config.open ? this.open() : this.close();\n\n    this.el.appendChild(this._rowsEl);\n    this.el.appendChild(this._controls);\n  }\n\n  /**\n   * Toggles between open and close modes.\n   */\n  toggleControls() {\n    if (this._isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  /**\n   * Opens the debugging panel.\n   */\n  open() {\n    // Use max-height with large value to transition\n    // to/from a non-specific height (like auto/100%)\n    // https://stackoverflow.com/a/8331169\n    // @TODO investigate a more complete solution with correct timing,\n    // via something like http://n12v.com/css-transition-to-from-auto/\n    this._rowsEl.style.maxHeight = '100px';\n    this._isOpen = true;\n    this._controls.textContent = 'Close ARDebug';\n    for (let [, row] of this.rows) {\n      row.enable();\n    }\n  }\n\n  /**\n   * Closes the debugging panel.\n   */\n  close() {\n    this._rowsEl.style.maxHeight = '0px';\n    this._isOpen = false;\n    this._controls.textContent = 'Open ARDebug';\n    for (let [, row] of this.rows) {\n      row.disable();\n    }\n  }\n\n  /**\n   * Returns the ARDebugView root element.\n   *\n   * @return {HTMLElement}\n   */\n  getElement() {\n    return this.el;\n  }\n\n  /**\n   * Adds a row to the ARDebugView.\n   *\n   * @param {string} id\n   * @param {ARDebugRow} row\n   */\n  addRow(id, row) {\n    this.rows.set(id, row);\n\n    if (this._isOpen) {\n      row.enable();\n    }\n\n    this._rowsEl.appendChild(row.getElement());\n  }\n}\n\n/**\n * A class that implements features being a row in the ARDebugView.\n */\nclass ARDebugRow {\n  /**\n   * @param {string} title\n   */\n  constructor(title) {\n    this.el = document.createElement('div');\n    this.el.style.width = '100%';\n    this.el.style.borderTop = '1px solid rgb(54, 54, 54)';\n    this.el.style.borderBottom = '1px solid #14171A';\n    this.el.style.position = 'relative';\n    this.el.style.padding = '3px 0px';\n    this.el.style.overflow = 'hidden';\n\n    this._titleEl = document.createElement('span');\n    this._titleEl.style.fontWeight = 'bold';\n    this._titleEl.textContent = title;\n\n    this._dataEl = document.createElement('span');\n    this._dataEl.style.position = 'absolute';\n    this._dataEl.style.left = '40px';\n\n    // Create a text element to update so we can avoid\n    // forced reflows when updating\n    // https://stackoverflow.com/a/17203046\n    this._dataElText = document.createTextNode('');\n    this._dataEl.appendChild(this._dataElText);\n\n    this.el.appendChild(this._titleEl);\n    this.el.appendChild(this._dataEl);\n\n    this.update = throttle(this.update, 500, this);\n  }\n\n  /**\n   * Enables the proxying and inspection functionality of\n   * this row. Should be implemented by child class.\n   */\n  enable() {\n    throw new Error('Implement in child class');\n  }\n\n  /**\n   * Disables the proxying and inspection functionality of\n   * this row. Should be implemented by child class.\n   */\n  disable() {\n    throw new Error('Implement in child class');\n  }\n\n  /**\n   * Returns the ARDebugRow's root element.\n   *\n   * @return {HTMLElement}\n   */\n  getElement() {\n    return this.el;\n  }\n\n  /**\n   * Updates the row's value.\n   *\n   * @param {string} value\n   * @param {boolean} isSuccess\n   */\n  update(value, isSuccess) {\n    this._dataElText.nodeValue = value;\n    this._dataEl.style.color = isSuccess ? SUCCESS_COLOR : FAILURE_COLOR;\n  }\n}\n\n/**\n * The ARDebugRow subclass for displaying hit information\n * by wrapping `vrDisplay.hitTest` and displaying the results.\n */\nclass ARDebugHitTestRow extends ARDebugRow {\n  /**\n   * @param {VRDisplay} vrDisplay\n   */\n  constructor(vrDisplay) {\n    super('Hit');\n    this.vrDisplay = vrDisplay;\n    this._onHitTest = this._onHitTest.bind(this);\n\n    // Store the native hit test, or proxy the native `hitTest` call with our own\n    this._nativeHitTest = cachedVRDisplayMethods.get('hitTest') || this.vrDisplay.hitTest;\n    cachedVRDisplayMethods.set('hitTest', this._nativeHitTest);\n\n    this._didPreviouslyHit = null;\n  }\n\n  /**\n   * Enables the tracking of hit test information.\n   */\n  enable() {\n    this.vrDisplay.hitTest = this._onHitTest;\n  }\n\n  /**\n   * Disables the tracking of hit test information.\n   */\n  disable() {\n    this.vrDisplay.hitTest = this._nativeHitTest;\n  }\n\n  /**\n   * @param {VRHit} hit\n   * @return {string}\n   */\n  _hitToString(hit) {\n    const mm = hit.modelMatrix;\n    return `${mm[12].toFixed(2)}, ${mm[13].toFixed(2)}, ${mm[14].toFixed(2)}`;\n  }\n\n  /**\n   * @param {number} x\n   * @param {number} y\n   * @return {VRHit?}\n   */\n  _onHitTest(x, y) {\n    const hits = this._nativeHitTest.call(this.vrDisplay, x, y);\n\n    const t = (parseInt(performance.now(), 10) / 1000).toFixed(1);\n    const didHit = hits && hits.length;\n\n    this.update(`${didHit ? this._hitToString(hits[0]) : 'MISS'} @ ${t}s`, didHit);\n    this._didPreviouslyHit = didHit;\n    return hits;\n  }\n}\n\n/**\n * The ARDebugRow subclass for displaying pose information\n * by wrapping `vrDisplay.getFrameData` and displaying the results.\n */\nclass ARDebugPoseRow extends ARDebugRow {\n  /**\n   * @param {VRDisplay} vrDisplay\n   */\n  constructor(vrDisplay) {\n    super('Pose');\n    this.vrDisplay = vrDisplay;\n    this._onGetFrameData = this._onGetFrameData.bind(this);\n\n    // Store the native hit test, or proxy the native `hitTest` call with our own\n    this._nativeGetFrameData = cachedVRDisplayMethods.get('getFrameData') ||\n                               this.vrDisplay.getFrameData;\n    cachedVRDisplayMethods.set('getFrameData', this._nativeGetFrameData);\n\n    this.update('Looking for position...');\n    this._initialPose = false;\n  }\n\n  /**\n   * Enables displaying and pulling getFrameData\n   */\n  enable() {\n    this.vrDisplay.getFrameData = this._onGetFrameData;\n  }\n\n  /**\n   * Disables displaying and pulling getFrameData\n   */\n  disable() {\n    this.vrDisplay.getFrameData = this._nativeGetFrameData;\n  }\n\n  /**\n   * @param {VRPose} pose\n   * @return {string}\n   */\n  _poseToString(pose) {\n    return `${pose[0].toFixed(2)}, ${pose[1].toFixed(2)}, ${pose[2].toFixed(2)}`;\n  }\n\n  /**\n   * Wrapper around getFrameData\n   *\n   * @param {VRFrameData} frameData\n   * @return {boolean}\n   */\n  _onGetFrameData(frameData) {\n    const results = this._nativeGetFrameData.call(this.vrDisplay, frameData);\n    const pose = frameData && frameData.pose && frameData.pose.position;\n    // Ensure we have a valid pose; while the pose SHOULD be null when not\n    // provided by the VRDisplay, on WebARonARCore, the xyz values of position\n    // are all 0 -- mark this as an invalid pose\n    const isValidPose = pose &&\n                        typeof pose[0] === 'number' &&\n                        typeof pose[1] === 'number' &&\n                        typeof pose[2] === 'number' &&\n                        !(pose[0] === 0 && pose[1] === 0 && pose[2] === 0);\n\n    // If we haven't received a pose yet, and still don't have a valid pose\n    // leave the message how it is\n    if (!this._initialPose && !isValidPose) {\n      return results;\n    }\n\n    if (isValidPose) {\n      this.update(this._poseToString(pose), true);\n    } else if (!isValidPose && this._lastPoseValid !== false) {\n      this.update(`Position lost`, false);\n    }\n\n    this._lastPoseValid = isValidPose;\n    this._initialPose = true;\n\n    return results;\n  }\n}\n\n\n// THREE.ARDebug = ARDebug;\nexport { ARDebug };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PerspectiveCamera } from 'three';\n\n// Reuse the frame data for getting the projection matrix\nlet frameData;\n\n/**\n * Class extending a THREE.PerspectiveCamera, attempting\n * to use the projection matrix provided from an AR-enabled\n * VRDisplay. If no AR-enabled VRDisplay found, uses provided\n * parameters.\n */\nclass ARPerspectiveCamera extends PerspectiveCamera {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {number} fov\n   * @param {number} aspect\n   * @param {number} near\n   * @param {number} far\n   */\n  constructor(vrDisplay, fov, aspect, near, far) {\n    super(fov, aspect, near, far);\n    this.isARPerpsectiveCamera = true;\n    this.vrDisplay = vrDisplay;\n    this.updateProjectionMatrix();\n\n    if (!vrDisplay || !vrDisplay.capabilities.hasPassThroughCamera) {\n      console.warn(`ARPerspectiveCamera does not a VRDisplay with\n                    a pass through camera. Using supplied values and defaults\n                    instead of device camera intrinsics`);\n    }\n  }\n\n  /**\n   * Updates the underlying `projectionMatrix` property from\n   * the AR-enabled VRDisplay, or falls back to\n   * THREE.PerspectiveCamera.prototype.updateProjectionMatrix\n   */\n  updateProjectionMatrix() {\n    const projMatrix = this.getProjectionMatrix();\n    if (!projMatrix) {\n      super.updateProjectionMatrix();\n      return;\n    }\n\n    this.projectionMatrix.fromArray(projMatrix);\n  }\n\n  /**\n   * Gets the projection matrix from AR-enabled VRDisplay\n   * if possible.\n   * @return {!Float32Array}\n   */\n  getProjectionMatrix() {\n    if (this.vrDisplay && this.vrDisplay.getFrameData) {\n      if (!frameData) {\n        frameData = new VRFrameData();\n      }\n      this.vrDisplay.getFrameData(frameData);\n\n      // Can use either left or right projection matrix\n      return frameData.leftProjectionMatrix;\n    }\n    return null;\n  }\n}\n\n\n// THREE.ARPerspectiveCamera = ARPerspectiveCamera;\nexport { ARPerspectiveCamera };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OBJLoader, MTLLoader } from 'three';\n\n/**\n * This module contains promisified loaders for internal use for\n * exposed ARUtils.\n */\n\nconst noop = function() {};\n\nexport const loadObj = (objPath, materials) => new Promise((resolve, reject) => {\n  const loader = new OBJLoader();\n\n  if (materials) {\n    loader.setMaterials(materials);\n  }\n\n  loader.load(objPath, resolve, noop, reject);\n});\n\nexport const loadMtl = mtlPath => new Promise((resolve, reject) => {\n  const loader = new MTLLoader();\n  const pathChunks = mtlPath.split('/');\n\n  if (pathChunks.length >= 2) {\n    loader.setTexturePath(pathChunks[pathChunks.length - 2]);\n  }\n\n  loader.load(mtlPath, resolve, noop, reject);\n});\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Matrix4,\n  Vector3,\n  Quaternion,\n  Math,\n} from 'three';\nimport { loadMtl, loadObj } from './loaders';\n\nconst LEARN_MORE_LINK = 'https://developers.google.com/ar/develop/web/getting-started';\nconst UNSUPPORTED_MESSAGE = `This augmented reality experience requires\n  WebARonARCore or WebARonARKit, experimental browsers from Google\n  for Android and iOS. Learn more at the <a href=\"${LEARN_MORE_LINK}\">Google Developers site</a>.`;\n\nconst ARUtils = {};\n\nARUtils.isTango = display =>\n  display && display.displayName.toLowerCase().includes('tango');\nexport const isTango = ARUtils.isTango;\n\nARUtils.isARKit = display =>\n  display && display.displayName.toLowerCase().includes('arkit');\nexport const isARKit = ARUtils.isARKit;\n\nARUtils.isARDisplay = display => isARKit(display) || isTango(display);\nexport const isARDisplay = ARUtils.isARDisplay;\n\n/**\n * Returns a promise that resolves to either to a VRDisplay with\n * AR capabilities, or null if no valid AR devices found on the platform.\n *\n * @return {Promise<VRDisplay?>}\n */\nARUtils.getARDisplay = () => new Promise((resolve, reject) => {\n  if (!navigator.getVRDisplays) {\n    resolve(null);\n    return;\n  }\n\n  navigator.getVRDisplays().then(displays => {\n    if (!displays && displays.length === 0) {\n      resolve(null);\n      return;\n    }\n\n    for (let display of displays) {\n      if (isARDisplay(display)) {\n        resolve(display);\n        return;\n      }\n    }\n    resolve(null);\n  });\n});\nexport const getARDisplay = ARUtils.getARDisplay;\n\n/**\n * Takes a path for an OBJ model and optionally a path for an MTL\n * texture and returns a promise resolving to a THREE.Mesh loaded with\n * the appropriate material. Can be used on downloaded models from Blocks.\n *\n * @param {string} objPath\n * @param {string} mtlPath\n * @return {THREE.Mesh}\n */\nARUtils.loadBlocksModel = (objPath, mtlPath) => new Promise((resolve, reject) => {\n  if (!THREE.OBJLoader || !THREE.MTLLoader) {\n    reject(new Error('Must include THREE.OBJLoader and THREE.MTLLoader'));\n    return;\n  }\n\n  let p = Promise.resolve();\n\n  if (mtlPath) {\n    p = loadMtl(mtlPath);\n  }\n\n  p.then(materials => {\n    if (materials) {\n      materials.preload();\n    }\n    return loadObj(objPath, materials);\n  }).then(obj => {\n    const model = obj.children[0];\n    model.geometry.applyMatrix(\n      new Matrix4().makeRotationY(Math.degToRad(-90))\n    );\n\n    return model;\n  }).then(resolve, reject);\n});\nexport const loadBlocksModel = ARUtils.loadBlocksModel;\n\nconst model = new Matrix4();\nconst tempPos = new Vector3();\nconst tempQuat = new Quaternion();\nconst tempScale = new Vector3();\n\n/**\n * Takes a THREE.Object3D and a VRHit and positions and optionally orients\n * the object according to the transform of the VRHit. Can provide an\n * easing value between 0 and 1 corresponding to the lerp between the\n * object's current position/orientation, and the position/orientation of the\n * hit.\n *\n * @param {THREE.Object3D} object\n * @param {VRHit} hit\n * @param {number} easing\n * @param {boolean} applyOrientation\n */\nARUtils.placeObjectAtHit = (object, hit, easing=1, applyOrientation=false) => {\n  if (!hit || !hit.modelMatrix) {\n    throw new Error('placeObjectAtHit requires a VRHit object');\n  }\n\n  model.fromArray(hit.modelMatrix);\n\n  model.decompose(tempPos, tempQuat, tempScale);\n\n  if (easing === 1) {\n    object.position.copy(tempPos);\n    if (applyOrientation) {\n      object.quaternion.copy(tempQuat);\n    }\n  } else {\n    object.position.lerp(tempPos, easing);\n    if (applyOrientation) {\n      object.quaternion.slerp(tempQuat, easing);\n    }\n  }\n};\nexport const placeObjectAtHit = ARUtils.placeObjectAtHit;\n\n/**\n * Injects a DOM element into the current page prompting the user that\n * their browser does not support these AR features.\n */\nARUtils.displayUnsupportedMessage = () => {\n  const element = document.createElement('div');\n  element.id = 'webgl-error-message';\n  element.style.fontFamily = 'monospace';\n  element.style.fontSize = '13px';\n  element.style.fontWeight = 'normal';\n  element.style.textAlign = 'center';\n  element.style.background = '#fff';\n  element.style.border = '1px solid black';\n  element.style.color = '#000';\n  element.style.padding = '1.5em';\n  element.style.width = '400px';\n  element.style.margin = '5em auto 0';\n  element.innerHTML = UNSUPPORTED_MESSAGE;\n  document.body.appendChild(element);\n};\nexport const displayUnsupportedMessage = ARUtils.displayUnsupportedMessage;\n\n\nexport { ARUtils };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Mesh,\n  Vector3,\n  RingGeometry,\n  MeshBasicMaterial,\n  Matrix4,\n  Math,\n} from 'three';\nimport { placeObjectAtHit } from './ARUtils';\n\n/**\n * Class for creating a mesh that fires raycasts and lerps\n * a 3D object along the surface\n */\nclass ARReticle extends Mesh {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {number} innerRadius\n   * @param {number} outerRadius\n   * @param {number} color\n   * @param {number} easing\n   */\n  constructor(\n    vrDisplay,\n    innerRadius = 0.02,\n    outerRadius = 0.05,\n    color = 0xff0077,\n    easing = 0.25\n  ) {\n    const geometry = new RingGeometry(innerRadius, outerRadius, 36, 64);\n    const material = new MeshBasicMaterial({ color });\n\n    // Orient the geometry so it's position is flat on a horizontal surface\n    geometry.applyMatrix(new Matrix4().makeRotationX(Math.degToRad(-90)));\n\n    super(geometry, material);\n    this.visible = false;\n\n    this.easing = easing;\n    this.applyOrientation = true;\n    this.vrDisplay = vrDisplay;\n    this._planeDir = new Vector3();\n  }\n\n  /**\n   * Attempt to fire a raycast from normalized screen coordinates\n   * x and y and lerp the reticle to the position.\n   *\n   * @param {number} x\n   * @param {number} y\n   */\n  update(x = 0.5, y = 0.5) {\n    if (!this.vrDisplay || !this.vrDisplay.hitTest) {\n      return;\n    }\n\n    const hit = this.vrDisplay.hitTest(x, y);\n    if (hit && hit.length > 0) {\n      this.visible = true;\n      placeObjectAtHit(this, hit[0], this.applyOrientation, this.easing);\n    }\n  }\n}\n\n\n// THREE.ARReticle = ARReticle;\nexport { ARReticle };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isARKit } from './ARUtils';\nimport vertexSource from './shaders/arview.vert';\nimport fragmentSource from './shaders/arview.frag';\n\n/**\n * Creates and load a shader from a string, type specifies either 'vertex' or 'fragment'\n *\n * @param {WebGLRenderingContext} gl\n * @param {string} str\n * @param {string} type\n * @return {!WebGLShader}\n */\nfunction getShader(gl, str, type) {\n  let shader;\n  if (type == 'fragment') {\n    shader = gl.createShader(gl.FRAGMENT_SHADER);\n  } else if (type == 'vertex') {\n    shader = gl.createShader(gl.VERTEX_SHADER);\n  } else {\n    return null;\n  }\n\n  gl.shaderSource(shader, str);\n  gl.compileShader(shader);\n\n  const result = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (!result) {\n    alert(gl.getShaderInfoLog(shader));\n    return null;\n  }\n\n  return shader;\n}\n\n/**\n * Creates a shader program from vertex and fragment shader sources\n *\n * @param {WebGLRenderingContext} gl\n * @param {string} vs\n * @param {string} fs\n * @return {!WebGLProgram}\n */\nfunction getProgram(gl, vs, fs) {\n  const vertexShader = getShader(gl, vs, 'vertex');\n  const fragmentShader = getShader(gl, fs, 'fragment');\n  if (!fragmentShader) {\n    return null;\n  }\n\n  const shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertexShader);\n  gl.attachShader(shaderProgram, fragmentShader);\n  gl.linkProgram(shaderProgram);\n\n  const result = gl.getProgramParameter(shaderProgram, gl.LINK_STATUS);\n  if (!result) {\n    alert('Could not initialise arview shaders');\n  }\n\n  return shaderProgram;\n}\n\n/**\n * Calculate the correct orientation depending on the device and the camera\n * orientations.\n *\n * @param {number} screenOrientation\n * @param {number} seeThroughCameraOrientation\n * @return {number}\n */\nfunction combineOrientations(screenOrientation, seeThroughCameraOrientation) {\n  let seeThroughCameraOrientationIndex = 0;\n  switch (seeThroughCameraOrientation) {\n    case 90:\n      seeThroughCameraOrientationIndex = 1;\n      break;\n    case 180:\n      seeThroughCameraOrientationIndex = 2;\n      break;\n    case 270:\n      seeThroughCameraOrientationIndex = 3;\n      break;\n    default:\n      seeThroughCameraOrientationIndex = 0;\n      break;\n  }\n  let screenOrientationIndex = 0;\n  switch (screenOrientation) {\n    case 90:\n      screenOrientationIndex = 1;\n      break;\n    case 180:\n      screenOrientationIndex = 2;\n      break;\n    case 270:\n      screenOrientationIndex = 3;\n      break;\n    default:\n      screenOrientationIndex = 0;\n      break;\n  }\n  let ret = screenOrientationIndex - seeThroughCameraOrientationIndex;\n  if (ret < 0) {\n    ret += 4;\n  }\n  return ret % 4;\n}\n\n/**\n * Renders the ar camera's video texture\n */\nclass ARVideoRenderer {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {WebGLRenderingContext} gl\n   */\n  constructor(vrDisplay, gl) {\n    this.vrDisplay = vrDisplay;\n    this.gl = gl;\n    if (this.vrDisplay) {\n      this.passThroughCamera = vrDisplay.getPassThroughCamera();\n      this.program = getProgram(gl, vertexSource, fragmentSource);\n    }\n\n    gl.useProgram(this.program);\n\n    // Setup a quad\n    this.vertexPositionAttribute = gl.getAttribLocation(\n      this.program,\n      'aVertexPosition'\n    );\n    this.textureCoordAttribute = gl.getAttribLocation(\n      this.program,\n      'aTextureCoord'\n    );\n\n    this.samplerUniform = gl.getUniformLocation(this.program, 'uSampler');\n\n    this.vertexPositionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBuffer);\n    let vertices = [\n      -1.0,\n      1.0,\n      0.0,\n      -1.0,\n      -1.0,\n      0.0,\n      1.0,\n      1.0,\n      0.0,\n      1.0,\n      -1.0,\n      0.0,\n    ];\n    let f32Vertices = new Float32Array(vertices);\n    gl.bufferData(gl.ARRAY_BUFFER, f32Vertices, gl.STATIC_DRAW);\n    this.vertexPositionBuffer.itemSize = 3;\n    this.vertexPositionBuffer.numItems = 12;\n\n    this.textureCoordBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.textureCoordBuffer);\n    // Precalculate different texture UV coordinates depending on the possible\n    // orientations of the device depending if there is a VRDisplay or not\n    let textureCoords = null;\n    if (this.vrDisplay) {\n      let u =\n        this.passThroughCamera.width / this.passThroughCamera.textureWidth;\n      let v =\n        this.passThroughCamera.height / this.passThroughCamera.textureHeight;\n      textureCoords = [\n        [0.0, 0.0, 0.0, v, u, 0.0, u, v],\n        [u, 0.0, 0.0, 0.0, u, v, 0.0, v],\n        [u, v, u, 0.0, 0.0, v, 0.0, 0.0],\n        [0.0, v, u, v, 0.0, 0.0, u, 0.0],\n      ];\n    } else {\n      textureCoords = [\n        [0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0],\n        [1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0],\n        [1.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0],\n        [0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0],\n      ];\n    }\n\n    this.f32TextureCoords = [];\n    for (let i = 0; i < textureCoords.length; i++) {\n      this.f32TextureCoords.push(new Float32Array(textureCoords[i]));\n    }\n    // Store the current combined orientation to check if it has changed\n    // during the update calls and use the correct texture coordinates.\n    this.combinedOrientation = combineOrientations(\n      screen.orientation.angle,\n      this.passThroughCamera.orientation\n    );\n\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      this.f32TextureCoords[this.combinedOrientation],\n      gl.STATIC_DRAW\n    );\n    this.textureCoordBuffer.itemSize = 2;\n    this.textureCoordBuffer.numItems = 8;\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n    this.indexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    let indices = [0, 1, 2, 2, 1, 3];\n    let ui16Indices = new Uint16Array(indices);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, ui16Indices, gl.STATIC_DRAW);\n    this.indexBuffer.itemSize = 1;\n    this.indexBuffer.numItems = 6;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n    this.texture = gl.createTexture();\n    gl.useProgram(null);\n\n    // The projection matrix will be based on an identify orthographic camera\n    this.projectionMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    this.mvMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    return this;\n  }\n\n  /**\n   * Renders the quad\n   */\n  render() {\n    let gl = this.gl;\n    gl.useProgram(this.program);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBuffer);\n    gl.enableVertexAttribArray(this.vertexPositionAttribute);\n    gl.vertexAttribPointer(\n      this.vertexPositionAttribute,\n      this.vertexPositionBuffer.itemSize,\n      gl.FLOAT,\n      false,\n      0,\n      0\n    );\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.textureCoordBuffer);\n\n    // Check the current orientation of the device combined with the\n    // orientation of the VRSeeThroughCamera to determine the correct UV\n    // coordinates to be used.\n    let combinedOrientation = combineOrientations(\n      screen.orientation.angle,\n      this.passThroughCamera.orientation\n    );\n    if (combinedOrientation !== this.combinedOrientation) {\n      this.combinedOrientation = combinedOrientation;\n      gl.bufferData(\n        gl.ARRAY_BUFFER,\n        this.f32TextureCoords[this.combinedOrientation],\n        gl.STATIC_DRAW\n      );\n    }\n    gl.enableVertexAttribArray(this.textureCoordAttribute);\n    gl.vertexAttribPointer(\n      this.textureCoordAttribute,\n      this.textureCoordBuffer.itemSize,\n      gl.FLOAT,\n      false,\n      0,\n      0\n    );\n\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_EXTERNAL_OES, this.texture);\n    // Update the content of the texture in every frame.\n    gl.texImage2D(\n      gl.TEXTURE_EXTERNAL_OES,\n      0,\n      gl.RGB,\n      gl.RGB,\n      gl.UNSIGNED_BYTE,\n      this.passThroughCamera\n    );\n    gl.uniform1i(this.samplerUniform, 0);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    gl.drawElements(\n      gl.TRIANGLES,\n      this.indexBuffer.numItems,\n      gl.UNSIGNED_SHORT,\n      0\n    );\n\n    // Disable enabled states to allow other render calls to correctly work\n    gl.bindTexture(gl.TEXTURE_EXTERNAL_OES, null);\n    gl.disableVertexAttribArray(this.vertexPositionAttribute);\n    gl.disableVertexAttribArray(this.textureCoordAttribute);\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    gl.useProgram(null);\n  }\n}\n\n/**\n * A helper class that takes a VRDisplay with AR capabilities\n * and renders the see through camera to the passed in WebGLRenderer's\n * context.\n */\nclass ARView {\n  /**\n   * @param {VRDisplay} vrDisplay\n   * @param {THREE.WebGLRenderer} renderer\n   */\n  constructor(vrDisplay, renderer) {\n    this.vrDisplay = vrDisplay;\n    if (isARKit(this.vrDisplay)) {\n      return;\n    }\n    this.renderer = renderer;\n    this.gl = renderer.context;\n\n    this.videoRenderer = new ARVideoRenderer(vrDisplay, this.gl);\n    this._resetGLState();\n\n    // Cache the width/height so we're not potentially forcing\n    // a reflow if there's been a style invalidation\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n    window.addEventListener('resize', this.onWindowResize.bind(this), false);\n  }\n\n  /**\n   * Updates the stored width/height of window on resize.\n   */\n  onWindowResize() {\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n  }\n\n  /**\n   * Renders the see through camera to the passed in renderer\n   */\n  render() {\n    if (isARKit(this.vrDisplay)) {\n      return;\n    }\n\n    let gl = this.gl;\n    let dpr = window.devicePixelRatio;\n    let width = this.width * dpr;\n    let height = this.height * dpr;\n\n    if (gl.viewportWidth !== width) {\n      gl.viewportWidth = width;\n    }\n\n    if (gl.viewportHeight !== height) {\n      gl.viewportHeight = height;\n    }\n\n    this.gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);\n    this.videoRenderer.render();\n    this._resetGLState();\n  }\n\n  /**\n   * Resets the GL state in the THREE.WebGLRenderer.\n   */\n  _resetGLState() {\n    if (typeof this.renderer.resetGLState === 'function') {\n      // If using three.js <= r86\n      this.renderer.resetGLState();\n    } else {\n      // If using three.js >= r87\n      this.renderer.state.reset();\n    }\n  }\n}\n\n\n// THREE.ARView = ARView;\nexport { ARView };\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /* eslint-disable */\n(function() {\n  if (window.webarSpeechRecognitionInstance) {\n\n    function addEventHandlingToObject(object) {\n      object.listeners = { };\n      object.addEventListener = function(eventType, callback) {\n        if (!callback) {\n          return this;\n        }\n        var listeners = this.listeners[eventType];\n        if (!listeners) {\n          this.listeners[eventType] = listeners = [];\n        }\n        if (listeners.indexOf(callback) < 0) {\n          listeners.push(callback);\n        }\n        return this;\n      };\n      object.removeEventListener = function(eventType, callback) {\n        if (!callback) {\n          return this;\n        }\n        var listeners = this.listeners[eventType];\n        if (listeners) {\n          var i = listeners.indexOf(callback);\n          if (i >= 0) {\n            this.listeners[eventType] = listeners.splice(i, 1);\n          }\n        }\n        return this;\n      };\n      object.callEventListeners = function(eventType, event) {\n        if (!event) {\n          event = { target : this };\n        }\n        if (!event.target) {\n          event.target = this;\n        }\n        event.type = eventType;\n        var onEventType = 'on' + eventType;\n        if (typeof(this[onEventType]) === 'function') {\n          this[onEventType](event)\n        }\n        var listeners = this.listeners[eventType];\n        if (listeners) {\n          for (var i = 0; i < listeners.length; i++) {\n            var typeofListener = typeof(listeners[i]);\n            if (typeofListener === 'object') {\n              listeners[i].handleEvent(event);\n            }\n            else if (typeofListener === 'function') {\n              listeners[i](event);\n            }\n          }\n        }\n        return this;\n      };\n    } \n\n    addEventHandlingToObject(window.webarSpeechRecognitionInstance);\n    var originalWebKitSpeechRecognition = window.webkitSpeechRecognition;\n    window.webkitSpeechRecognition = function() {\n      return window.webarSpeechRecognitionInstance;\n    };\n  }\n})();\n","/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint no-unused-vars: \"off\" */\n\nexport { ARDebug } from './ARDebug';\nexport { ARPerspectiveCamera } from './ARPerspectiveCamera';\nexport { ARReticle } from './ARReticle';\nexport { ARUtils } from './ARUtils';\nexport { ARView } from './ARView';\nimport './ARSpeechRecognition';\n"],"names":["DEFAULTS","open","showLastHit","showPoseStatus","SUCCESS_COLOR","FAILURE_COLOR","cachedVRDisplayMethods","Map","throttle","fn","timer","scope","lastFired","timeout","args","current","Date","until","undefined","apply","clearTimeout","setTimeout","ARDebug","vrDisplay","config","Object","assign","_view","ARDebugView","hitTest","addRow","ARDebugHitTestRow","getFrameData","ARDebugPoseRow","close","getElement","rows","el","document","createElement","style","backgroundColor","padding","fontFamily","color","position","right","top","width","fontSize","zIndex","_rowsEl","transitionProperty","transitionDuration","transitionDelay","transitionTimingFunction","overflow","_controls","fontWeight","paddingTop","textAlign","cursor","addEventListener","toggleControls","bind","appendChild","_isOpen","maxHeight","textContent","row","enable","disable","id","set","ARDebugRow","title","borderTop","borderBottom","_titleEl","_dataEl","left","_dataElText","createTextNode","update","Error","value","isSuccess","nodeValue","_onHitTest","_nativeHitTest","get","_didPreviouslyHit","hit","mm","modelMatrix","toFixed","x","y","hits","call","t","parseInt","performance","now","didHit","length","_hitToString","_onGetFrameData","_nativeGetFrameData","_initialPose","pose","frameData","results","isValidPose","_poseToString","_lastPoseValid","ARPerspectiveCamera","fov","aspect","near","far","isARPerpsectiveCamera","updateProjectionMatrix","capabilities","hasPassThroughCamera","console","warn","projMatrix","getProjectionMatrix","projectionMatrix","fromArray","VRFrameData","leftProjectionMatrix","PerspectiveCamera","noop","loadObj","objPath","materials","Promise","resolve","reject","loader","OBJLoader","setMaterials","load","loadMtl","MTLLoader","pathChunks","mtlPath","split","setTexturePath","LEARN_MORE_LINK","UNSUPPORTED_MESSAGE","ARUtils","isTango","display","displayName","toLowerCase","includes","isARKit","isARDisplay","getARDisplay","navigator","getVRDisplays","then","displays","loadBlocksModel","THREE","p","preload","model","obj","children","geometry","applyMatrix","Matrix4","makeRotationY","Math","degToRad","tempPos","Vector3","tempQuat","Quaternion","tempScale","placeObjectAtHit","object","easing","applyOrientation","decompose","copy","quaternion","lerp","slerp","displayUnsupportedMessage","element","background","border","margin","innerHTML","body","ARReticle","innerRadius","outerRadius","RingGeometry","material","MeshBasicMaterial","makeRotationX","visible","_planeDir","Mesh","getShader","gl","str","type","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","result","getShaderParameter","COMPILE_STATUS","alert","getShaderInfoLog","getProgram","vs","fs","vertexShader","fragmentShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","combineOrientations","screenOrientation","seeThroughCameraOrientation","seeThroughCameraOrientationIndex","screenOrientationIndex","ret","ARVideoRenderer","passThroughCamera","getPassThroughCamera","program","vertexSource","fragmentSource","useProgram","vertexPositionAttribute","getAttribLocation","textureCoordAttribute","samplerUniform","getUniformLocation","vertexPositionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","vertices","f32Vertices","Float32Array","bufferData","STATIC_DRAW","itemSize","numItems","textureCoordBuffer","textureCoords","u","textureWidth","v","height","textureHeight","f32TextureCoords","i","push","combinedOrientation","screen","orientation","angle","indexBuffer","ELEMENT_ARRAY_BUFFER","indices","ui16Indices","Uint16Array","texture","createTexture","mvMatrix","enableVertexAttribArray","vertexAttribPointer","FLOAT","activeTexture","TEXTURE0","bindTexture","TEXTURE_EXTERNAL_OES","texImage2D","RGB","UNSIGNED_BYTE","uniform1i","drawElements","TRIANGLES","UNSIGNED_SHORT","disableVertexAttribArray","ARView","renderer","context","videoRenderer","_resetGLState","window","innerWidth","innerHeight","onWindowResize","dpr","devicePixelRatio","viewportWidth","viewportHeight","viewport","render","resetGLState","state","reset","webarSpeechRecognitionInstance","addEventHandlingToObject","listeners","eventType","callback","indexOf","removeEventListener","splice","callEventListeners","event","target","onEventType","typeofListener","handleEvent","webkitSpeechRecognition"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAAA;;;;;;;;;;;;;;;AAeA,KAAMA,WAAW;CACfC,QAAM,IADS;CAEfC,eAAa,IAFE;CAGfC,kBAAgB;CAHD,CAAjB;;AAMA,KAAMC,gBAAgB,SAAtB;AACA,KAAMC,gBAAgB,SAAtB;;CAEA;CACA;CACA;CACA;AACA,KAAIC,yBAAyB,IAAIC,GAAJ,EAA7B;;CAEA;;;;;;;;;;CAUA,SAASC,QAAT,CAAkBC,EAAlB,EAAsBC,KAAtB,EAA6BC,KAA7B,EAAoC;CAClC,MAAIC,kBAAJ;CACA,MAAIC,gBAAJ;;CAEA,SAAO,YAAa;CAAA,sCAATC,IAAS;CAATA,UAAS;CAAA;;CAClB,QAAMC,UAAU,CAAC,IAAIC,IAAJ,EAAjB;CACA,QAAIC,cAAJ;;CAEA,QAAIL,SAAJ,EAAe;CACbK,cAAQL,YAAYF,KAAZ,GAAoBK,OAA5B;CACD;;CAED,QAAIE,SAASC,SAAT,IAAsBD,QAAQ,CAAlC,EAAqC;CACnCL,kBAAYG,OAAZ;CACAN,SAAGU,KAAH,CAASR,KAAT,EAAgBG,IAAhB;CACD,KAHD,MAGO,IAAIG,SAAS,CAAb,EAAgB;CACrBG,mBAAaP,OAAb;CACAA,gBAAUQ,WAAW,YAAM;CACzBT,oBAAYG,OAAZ;CACAN,WAAGU,KAAH,CAASR,KAAT,EAAgBG,IAAhB;CACD,OAHS,EAGPG,KAHO,CAAV;CAID;CACF,GAlBD;CAmBD;CACD;;;;;KAIMK;CACJ;;;;;;;CAOA,mBAAYC,SAAZ,EAAkC;CAAA,QAAXC,MAAW,uEAAJ,EAAI;CAAA;;CAChC,SAAKA,MAAL,GAAcC,OAAOC,MAAP,CAAc,EAAd,EAAkBF,MAAlB,EAA0BxB,QAA1B,CAAd;CACA,SAAKuB,SAAL,GAAiBA,SAAjB;;CAEA,SAAKI,KAAL,GAAa,IAAIC,WAAJ,CAAgB,EAAE3B,MAAM,KAAKuB,MAAL,CAAYvB,IAApB,EAAhB,CAAb;;CAEA,QAAI,KAAKuB,MAAL,CAAYtB,WAAZ,IAA2B,KAAKqB,SAAL,CAAeM,OAA9C,EAAuD;CACrD,WAAKF,KAAL,CAAWG,MAAX,CAAkB,UAAlB,EAA8B,IAAIC,iBAAJ,CAAsBR,SAAtB,CAA9B;CACD;;CAED,QAAI,KAAKC,MAAL,CAAYrB,cAAZ,IAA8B,KAAKoB,SAAL,CAAeS,YAAjD,EAA+D;CAC7D,WAAKL,KAAL,CAAWG,MAAX,CAAkB,aAAlB,EAAiC,IAAIG,cAAJ,CAAmBV,SAAnB,CAAjC;CACD;CACF;;CAED;;;;;;;4BAGO;CACL,WAAKI,KAAL,CAAW1B,IAAX;CACD;;CAED;;;;;;6BAGQ;CACN,WAAK0B,KAAL,CAAWO,KAAX;CACD;;CAED;;;;;;;;kCAKa;CACX,aAAO,KAAKP,KAAL,CAAWQ,UAAX,EAAP;CACD;;;;;CAGH;;;;;;KAIMP;CACJ;;;;CAIA,yBAAuB;CAAA,QAAXJ,MAAW,uEAAJ,EAAI;CAAA;;CACrB,SAAKY,IAAL,GAAY,IAAI7B,GAAJ,EAAZ;;CAEA,SAAK8B,EAAL,GAAUC,SAASC,aAAT,CAAuB,KAAvB,CAAV;CACA,SAAKF,EAAL,CAAQG,KAAR,CAAcC,eAAd,GAAgC,MAAhC;CACA,SAAKJ,EAAL,CAAQG,KAAR,CAAcE,OAAd,GAAwB,KAAxB;CACA,SAAKL,EAAL,CAAQG,KAAR,CAAcG,UAAd,GAA2B,mCAA3B;CACA,SAAKN,EAAL,CAAQG,KAAR,CAAcI,KAAd,GAAsB,oBAAtB;CACA,SAAKP,EAAL,CAAQG,KAAR,CAAcK,QAAd,GAAyB,UAAzB;CACA,SAAKR,EAAL,CAAQG,KAAR,CAAcM,KAAd,GAAsB,MAAtB;CACA,SAAKT,EAAL,CAAQG,KAAR,CAAcO,GAAd,GAAoB,KAApB;CACA,SAAKV,EAAL,CAAQG,KAAR,CAAcQ,KAAd,GAAsB,OAAtB;CACA,SAAKX,EAAL,CAAQG,KAAR,CAAcS,QAAd,GAAyB,MAAzB;CACA,SAAKZ,EAAL,CAAQG,KAAR,CAAcU,MAAd,GAAuB,IAAvB;;CAEA,SAAKC,OAAL,GAAeb,SAASC,aAAT,CAAuB,KAAvB,CAAf;CACA,SAAKY,OAAL,CAAaX,KAAb,CAAmBY,kBAAnB,GAAwC,YAAxC;CACA,SAAKD,OAAL,CAAaX,KAAb,CAAmBa,kBAAnB,GAAwC,MAAxC;CACA,SAAKF,OAAL,CAAaX,KAAb,CAAmBc,eAAnB,GAAqC,IAArC;CACA,SAAKH,OAAL,CAAaX,KAAb,CAAmBe,wBAAnB,GAA8C,UAA9C;CACA,SAAKJ,OAAL,CAAaX,KAAb,CAAmBgB,QAAnB,GAA8B,QAA9B;;CAEA,SAAKC,SAAL,GAAiBnB,SAASC,aAAT,CAAuB,KAAvB,CAAjB;CACA,SAAKkB,SAAL,CAAejB,KAAf,CAAqBS,QAArB,GAAgC,MAAhC;CACA,SAAKQ,SAAL,CAAejB,KAAf,CAAqBkB,UAArB,GAAkC,MAAlC;CACA,SAAKD,SAAL,CAAejB,KAAf,CAAqBmB,UAArB,GAAkC,KAAlC;CACA,SAAKF,SAAL,CAAejB,KAAf,CAAqBoB,SAArB,GAAiC,QAAjC;CACA,SAAKH,SAAL,CAAejB,KAAf,CAAqBqB,MAArB,GAA8B,SAA9B;CACA,SAAKJ,SAAL,CAAeK,gBAAf,CAAgC,OAAhC,EAAyC,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAzC;;CAEA;CACAxC,WAAOvB,IAAP,GAAc,KAAKA,IAAL,EAAd,GAA4B,KAAKiC,KAAL,EAA5B;;CAEA,SAAKG,EAAL,CAAQ4B,WAAR,CAAoB,KAAKd,OAAzB;CACA,SAAKd,EAAL,CAAQ4B,WAAR,CAAoB,KAAKR,SAAzB;CACD;;CAED;;;;;;;sCAGiB;CACf,UAAI,KAAKS,OAAT,EAAkB;CAChB,aAAKhC,KAAL;CACD,OAFD,MAEO;CACL,aAAKjC,IAAL;CACD;CACF;;CAED;;;;;;4BAGO;CACL;CACA;CACA;CACA;CACA;CACA,WAAKkD,OAAL,CAAaX,KAAb,CAAmB2B,SAAnB,GAA+B,OAA/B;CACA,WAAKD,OAAL,GAAe,IAAf;CACA,WAAKT,SAAL,CAAeW,WAAf,GAA6B,eAA7B;CARK;CAAA;CAAA;;CAAA;CASL,6BAAoB,KAAKhC,IAAzB,8HAA+B;CAAA;CAAA,cAAnBiC,GAAmB;;CAC7BA,cAAIC,MAAJ;CACD;CAXI;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAYN;;CAED;;;;;;6BAGQ;CACN,WAAKnB,OAAL,CAAaX,KAAb,CAAmB2B,SAAnB,GAA+B,KAA/B;CACA,WAAKD,OAAL,GAAe,KAAf;CACA,WAAKT,SAAL,CAAeW,WAAf,GAA6B,cAA7B;CAHM;CAAA;CAAA;;CAAA;CAIN,8BAAoB,KAAKhC,IAAzB,mIAA+B;CAAA;CAAA,cAAnBiC,GAAmB;;CAC7BA,cAAIE,OAAJ;CACD;CANK;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAOP;;CAED;;;;;;;;kCAKa;CACX,aAAO,KAAKlC,EAAZ;CACD;;CAED;;;;;;;;;4BAMOmC,IAAIH,KAAK;CACd,WAAKjC,IAAL,CAAUqC,GAAV,CAAcD,EAAd,EAAkBH,GAAlB;;CAEA,UAAI,KAAKH,OAAT,EAAkB;CAChBG,YAAIC,MAAJ;CACD;;CAED,WAAKnB,OAAL,CAAac,WAAb,CAAyBI,IAAIlC,UAAJ,EAAzB;CACD;;;;;CAGH;;;;;KAGMuC;CACJ;;;CAGA,sBAAYC,KAAZ,EAAmB;CAAA;;CACjB,SAAKtC,EAAL,GAAUC,SAASC,aAAT,CAAuB,KAAvB,CAAV;CACA,SAAKF,EAAL,CAAQG,KAAR,CAAcQ,KAAd,GAAsB,MAAtB;CACA,SAAKX,EAAL,CAAQG,KAAR,CAAcoC,SAAd,GAA0B,2BAA1B;CACA,SAAKvC,EAAL,CAAQG,KAAR,CAAcqC,YAAd,GAA6B,mBAA7B;CACA,SAAKxC,EAAL,CAAQG,KAAR,CAAcK,QAAd,GAAyB,UAAzB;CACA,SAAKR,EAAL,CAAQG,KAAR,CAAcE,OAAd,GAAwB,SAAxB;CACA,SAAKL,EAAL,CAAQG,KAAR,CAAcgB,QAAd,GAAyB,QAAzB;;CAEA,SAAKsB,QAAL,GAAgBxC,SAASC,aAAT,CAAuB,MAAvB,CAAhB;CACA,SAAKuC,QAAL,CAActC,KAAd,CAAoBkB,UAApB,GAAiC,MAAjC;CACA,SAAKoB,QAAL,CAAcV,WAAd,GAA4BO,KAA5B;;CAEA,SAAKI,OAAL,GAAezC,SAASC,aAAT,CAAuB,MAAvB,CAAf;CACA,SAAKwC,OAAL,CAAavC,KAAb,CAAmBK,QAAnB,GAA8B,UAA9B;CACA,SAAKkC,OAAL,CAAavC,KAAb,CAAmBwC,IAAnB,GAA0B,MAA1B;;CAEA;CACA;CACA;CACA,SAAKC,WAAL,GAAmB3C,SAAS4C,cAAT,CAAwB,EAAxB,CAAnB;CACA,SAAKH,OAAL,CAAad,WAAb,CAAyB,KAAKgB,WAA9B;;CAEA,SAAK5C,EAAL,CAAQ4B,WAAR,CAAoB,KAAKa,QAAzB;CACA,SAAKzC,EAAL,CAAQ4B,WAAR,CAAoB,KAAKc,OAAzB;;CAEA,SAAKI,MAAL,GAAc3E,SAAS,KAAK2E,MAAd,EAAsB,GAAtB,EAA2B,IAA3B,CAAd;CACD;;CAED;;;;;;;;8BAIS;CACP,YAAM,IAAIC,KAAJ,CAAU,0BAAV,CAAN;CACD;;CAED;;;;;;;+BAIU;CACR,YAAM,IAAIA,KAAJ,CAAU,0BAAV,CAAN;CACD;;CAED;;;;;;;;kCAKa;CACX,aAAO,KAAK/C,EAAZ;CACD;;CAED;;;;;;;;;4BAMOgD,OAAOC,WAAW;CACvB,WAAKL,WAAL,CAAiBM,SAAjB,GAA6BF,KAA7B;CACA,WAAKN,OAAL,CAAavC,KAAb,CAAmBI,KAAnB,GAA2B0C,YAAYlF,aAAZ,GAA4BC,aAAvD;CACD;;;;;CAGH;;;;;;KAIM0B;;;CACJ;;;CAGA,6BAAYR,SAAZ,EAAuB;CAAA;;CAAA,qIACf,KADe;;CAErB,UAAKA,SAAL,GAAiBA,SAAjB;CACA,UAAKiE,UAAL,GAAkB,MAAKA,UAAL,CAAgBxB,IAAhB,OAAlB;;CAEA;CACA,UAAKyB,cAAL,GAAsBnF,uBAAuBoF,GAAvB,CAA2B,SAA3B,KAAyC,MAAKnE,SAAL,CAAeM,OAA9E;CACAvB,2BAAuBmE,GAAvB,CAA2B,SAA3B,EAAsC,MAAKgB,cAA3C;;CAEA,UAAKE,iBAAL,GAAyB,IAAzB;CATqB;CAUtB;;CAED;;;;;;;8BAGS;CACP,WAAKpE,SAAL,CAAeM,OAAf,GAAyB,KAAK2D,UAA9B;CACD;;CAED;;;;;;+BAGU;CACR,WAAKjE,SAAL,CAAeM,OAAf,GAAyB,KAAK4D,cAA9B;CACD;;CAED;;;;;;;kCAIaG,KAAK;CAChB,UAAMC,KAAKD,IAAIE,WAAf;CACA,aAAUD,GAAG,EAAH,EAAOE,OAAP,CAAe,CAAf,CAAV,UAAgCF,GAAG,EAAH,EAAOE,OAAP,CAAe,CAAf,CAAhC,UAAsDF,GAAG,EAAH,EAAOE,OAAP,CAAe,CAAf,CAAtD;CACD;;CAED;;;;;;;;gCAKWC,GAAGC,GAAG;CACf,UAAMC,OAAO,KAAKT,cAAL,CAAoBU,IAApB,CAAyB,KAAK5E,SAA9B,EAAyCyE,CAAzC,EAA4CC,CAA5C,CAAb;;CAEA,UAAMG,IAAI,CAACC,SAASC,YAAYC,GAAZ,EAAT,EAA4B,EAA5B,IAAkC,IAAnC,EAAyCR,OAAzC,CAAiD,CAAjD,CAAV;CACA,UAAMS,SAASN,QAAQA,KAAKO,MAA5B;;CAEA,WAAKtB,MAAL,EAAeqB,SAAS,KAAKE,YAAL,CAAkBR,KAAK,CAAL,CAAlB,CAAT,GAAsC,MAArD,YAAiEE,CAAjE,QAAuEI,MAAvE;CACA,WAAKb,iBAAL,GAAyBa,MAAzB;CACA,aAAON,IAAP;CACD;;;GArD6BxB;;CAwDhC;;;;;;KAIMzC;;;CACJ;;;CAGA,0BAAYV,SAAZ,EAAuB;CAAA;;CAAA,gIACf,MADe;;CAErB,WAAKA,SAAL,GAAiBA,SAAjB;CACA,WAAKoF,eAAL,GAAuB,OAAKA,eAAL,CAAqB3C,IAArB,QAAvB;;CAEA;CACA,WAAK4C,mBAAL,GAA2BtG,uBAAuBoF,GAAvB,CAA2B,cAA3B,KACA,OAAKnE,SAAL,CAAeS,YAD1C;CAEA1B,2BAAuBmE,GAAvB,CAA2B,cAA3B,EAA2C,OAAKmC,mBAAhD;;CAEA,WAAKzB,MAAL,CAAY,yBAAZ;CACA,WAAK0B,YAAL,GAAoB,KAApB;CAXqB;CAYtB;;CAED;;;;;;;8BAGS;CACP,WAAKtF,SAAL,CAAeS,YAAf,GAA8B,KAAK2E,eAAnC;CACD;;CAED;;;;;;+BAGU;CACR,WAAKpF,SAAL,CAAeS,YAAf,GAA8B,KAAK4E,mBAAnC;CACD;;CAED;;;;;;;mCAIcE,MAAM;CAClB,aAAUA,KAAK,CAAL,EAAQf,OAAR,CAAgB,CAAhB,CAAV,UAAiCe,KAAK,CAAL,EAAQf,OAAR,CAAgB,CAAhB,CAAjC,UAAwDe,KAAK,CAAL,EAAQf,OAAR,CAAgB,CAAhB,CAAxD;CACD;;CAED;;;;;;;;;qCAMgBgB,WAAW;CACzB,UAAMC,UAAU,KAAKJ,mBAAL,CAAyBT,IAAzB,CAA8B,KAAK5E,SAAnC,EAA8CwF,SAA9C,CAAhB;CACA,UAAMD,OAAOC,aAAaA,UAAUD,IAAvB,IAA+BC,UAAUD,IAAV,CAAejE,QAA3D;CACA;CACA;CACA;CACA,UAAMoE,cAAcH,QACA,OAAOA,KAAK,CAAL,CAAP,KAAmB,QADnB,IAEA,OAAOA,KAAK,CAAL,CAAP,KAAmB,QAFnB,IAGA,OAAOA,KAAK,CAAL,CAAP,KAAmB,QAHnB,IAIA,EAAEA,KAAK,CAAL,MAAY,CAAZ,IAAiBA,KAAK,CAAL,MAAY,CAA7B,IAAkCA,KAAK,CAAL,MAAY,CAAhD,CAJpB;;CAMA;CACA;CACA,UAAI,CAAC,KAAKD,YAAN,IAAsB,CAACI,WAA3B,EAAwC;CACtC,eAAOD,OAAP;CACD;;CAED,UAAIC,WAAJ,EAAiB;CACf,aAAK9B,MAAL,CAAY,KAAK+B,aAAL,CAAmBJ,IAAnB,CAAZ,EAAsC,IAAtC;CACD,OAFD,MAEO,IAAI,CAACG,WAAD,IAAgB,KAAKE,cAAL,KAAwB,KAA5C,EAAmD;CACxD,aAAKhC,MAAL,kBAA6B,KAA7B;CACD;;CAED,WAAKgC,cAAL,GAAsBF,WAAtB;CACA,WAAKJ,YAAL,GAAoB,IAApB;;CAEA,aAAOG,OAAP;CACD;;;GA1E0BtC;;CC5W7B;;;;;;;;;;;;;;;AAeA,CAEA;AACA,KAAIqC,kBAAJ;;CAEA;;;;;;;KAMMK;;;CACJ;;;;;;;CAOA,+BAAY7F,SAAZ,EAAuB8F,GAAvB,EAA4BC,MAA5B,EAAoCC,IAApC,EAA0CC,GAA1C,EAA+C;CAAA;;CAAA,yIACvCH,GADuC,EAClCC,MADkC,EAC1BC,IAD0B,EACpBC,GADoB;;CAE7C,UAAKC,qBAAL,GAA6B,IAA7B;CACA,UAAKlG,SAAL,GAAiBA,SAAjB;CACA,UAAKmG,sBAAL;;CAEA,QAAI,CAACnG,SAAD,IAAc,CAACA,UAAUoG,YAAV,CAAuBC,oBAA1C,EAAgE;CAC9DC,cAAQC,IAAR;CAGD;CAV4C;CAW9C;;CAED;;;;;;;;;8CAKyB;CACvB,UAAMC,aAAa,KAAKC,mBAAL,EAAnB;CACA,UAAI,CAACD,UAAL,EAAiB;CACf;CACA;CACD;;CAED,WAAKE,gBAAL,CAAsBC,SAAtB,CAAgCH,UAAhC;CACD;;CAED;;;;;;;;2CAKsB;CACpB,UAAI,KAAKxG,SAAL,IAAkB,KAAKA,SAAL,CAAeS,YAArC,EAAmD;CACjD,YAAI,CAAC+E,SAAL,EAAgB;CACdA,sBAAY,IAAIoB,WAAJ,EAAZ;CACD;CACD,aAAK5G,SAAL,CAAeS,YAAf,CAA4B+E,SAA5B;;CAEA;CACA,eAAOA,UAAUqB,oBAAjB;CACD;CACD,aAAO,IAAP;CACD;;;GApD+BC;;CC1BlC;;;;;;;;;;;;;;;AAeA,CAEA;;;;;AAKA,KAAMC,OAAO,SAAPA,IAAO,GAAW,EAAxB;;AAEA,AAAO,KAAMC,UAAU,SAAVA,OAAU,CAACC,OAAD,EAAUC,SAAV;CAAA,SAAwB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CAC9E,QAAMC,SAAS,IAAIC,eAAJ,EAAf;;CAEA,QAAIL,SAAJ,EAAe;CACbI,aAAOE,YAAP,CAAoBN,SAApB;CACD;;CAEDI,WAAOG,IAAP,CAAYR,OAAZ,EAAqBG,OAArB,EAA8BL,IAA9B,EAAoCM,MAApC;CACD,GAR8C,CAAxB;CAAA,CAAhB;;AAUP,AAAO,KAAMK,UAAU,SAAVA,OAAU;CAAA,SAAW,IAAIP,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CACjE,QAAMC,SAAS,IAAIK,eAAJ,EAAf;CACA,QAAMC,aAAaC,QAAQC,KAAR,CAAc,GAAd,CAAnB;;CAEA,QAAIF,WAAW1C,MAAX,IAAqB,CAAzB,EAA4B;CAC1BoC,aAAOS,cAAP,CAAsBH,WAAWA,WAAW1C,MAAX,GAAoB,CAA/B,CAAtB;CACD;;CAEDoC,WAAOG,IAAP,CAAYI,OAAZ,EAAqBT,OAArB,EAA8BL,IAA9B,EAAoCM,MAApC;CACD,GATiC,CAAX;CAAA,CAAhB;;CClCP;;;;;;;;;;;;;;;AAeA,AAQA,KAAMW,kBAAkB,8DAAxB;AACA,KAAMC,6LAE8CD,eAF9C,kCAAN;;AAIA,KAAME,YAAU,EAAhB;;AAEAA,WAAQC,OAAR,GAAkB;CAAA,SAChBC,WAAWA,QAAQC,WAAR,CAAoBC,WAApB,GAAkCC,QAAlC,CAA2C,OAA3C,CADK;CAAA,CAAlB;AAEA,AAAO,KAAMJ,UAAUD,UAAQC,OAAxB;;AAEPD,WAAQM,OAAR,GAAkB;CAAA,SAChBJ,WAAWA,QAAQC,WAAR,CAAoBC,WAApB,GAAkCC,QAAlC,CAA2C,OAA3C,CADK;CAAA,CAAlB;AAEA,AAAO,KAAMC,UAAUN,UAAQM,OAAxB;;AAEPN,WAAQO,WAAR,GAAsB;CAAA,SAAWD,QAAQJ,OAAR,KAAoBD,QAAQC,OAAR,CAA/B;CAAA,CAAtB;AACA,AAAO,KAAMK,cAAcP,UAAQO,WAA5B;;CAEP;;;;;;AAMAP,WAAQQ,YAAR,GAAuB;CAAA,SAAM,IAAIvB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CAC5D,QAAI,CAACsB,UAAUC,aAAf,EAA8B;CAC5BxB,cAAQ,IAAR;CACA;CACD;;CAEDuB,cAAUC,aAAV,GAA0BC,IAA1B,CAA+B,oBAAY;CACzC,UAAI,CAACC,QAAD,IAAaA,SAAS5D,MAAT,KAAoB,CAArC,EAAwC;CACtCkC,gBAAQ,IAAR;CACA;CACD;;CAJwC;CAAA;CAAA;;CAAA;CAMzC,6BAAoB0B,QAApB,8HAA8B;CAAA,cAArBV,OAAqB;;CAC5B,cAAIK,YAAYL,OAAZ,CAAJ,EAA0B;CACxBhB,oBAAQgB,OAAR;CACA;CACD;CACF;CAXwC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;;CAYzChB,cAAQ,IAAR;CACD,KAbD;CAcD,GApB4B,CAAN;CAAA,CAAvB;AAqBA;;CAEA;;;;;;;;;AASAc,WAAQa,eAAR,GAA0B,UAAC9B,OAAD,EAAUY,OAAV;CAAA,SAAsB,IAAIV,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;CAC/E,QAAI,CAAC2B,MAAMzB,SAAP,IAAoB,CAACyB,MAAMrB,SAA/B,EAA0C;CACxCN,aAAO,IAAIxD,KAAJ,CAAU,kDAAV,CAAP;CACA;CACD;;CAED,QAAIoF,IAAI9B,QAAQC,OAAR,EAAR;;CAEA,QAAIS,OAAJ,EAAa;CACXoB,UAAIvB,QAAQG,OAAR,CAAJ;CACD;;CAEDoB,MAAEJ,IAAF,CAAO,qBAAa;CAClB,UAAI3B,SAAJ,EAAe;CACbA,kBAAUgC,OAAV;CACD;CACD,aAAOlC,QAAQC,OAAR,EAAiBC,SAAjB,CAAP;CACD,KALD,EAKG2B,IALH,CAKQ,eAAO;CACb,UAAMM,QAAQC,IAAIC,QAAJ,CAAa,CAAb,CAAd;CACAF,YAAMG,QAAN,CAAeC,WAAf,CACE,IAAIC,aAAJ,GAAcC,aAAd,CAA4BC,WAAKC,QAAL,CAAc,CAAC,EAAf,CAA5B,CADF;;CAIA,aAAOR,KAAP;CACD,KAZD,EAYGN,IAZH,CAYQzB,OAZR,EAYiBC,MAZjB;CAaD,GAzB+C,CAAtB;CAAA,CAA1B;AA0BA;;AAEA,KAAM8B,QAAQ,IAAIK,aAAJ,EAAd;AACA,KAAMI,UAAU,IAAIC,aAAJ,EAAhB;AACA,KAAMC,WAAW,IAAIC,gBAAJ,EAAjB;AACA,KAAMC,YAAY,IAAIH,aAAJ,EAAlB;;CAEA;;;;;;;;;;;;AAYA3B,WAAQ+B,gBAAR,GAA2B,UAACC,MAAD,EAAS7F,GAAT,EAAmD;CAAA,MAArC8F,MAAqC,uEAA9B,CAA8B;CAAA,MAA3BC,gBAA2B,uEAAV,KAAU;;CAC5E,MAAI,CAAC/F,GAAD,IAAQ,CAACA,IAAIE,WAAjB,EAA8B;CAC5B,UAAM,IAAIV,KAAJ,CAAU,0CAAV,CAAN;CACD;;CAEDsF,QAAMxC,SAAN,CAAgBtC,IAAIE,WAApB;;CAEA4E,QAAMkB,SAAN,CAAgBT,OAAhB,EAAyBE,QAAzB,EAAmCE,SAAnC;;CAEA,MAAIG,WAAW,CAAf,EAAkB;CAChBD,WAAO5I,QAAP,CAAgBgJ,IAAhB,CAAqBV,OAArB;CACA,QAAIQ,gBAAJ,EAAsB;CACpBF,aAAOK,UAAP,CAAkBD,IAAlB,CAAuBR,QAAvB;CACD;CACF,GALD,MAKO;CACLI,WAAO5I,QAAP,CAAgBkJ,IAAhB,CAAqBZ,OAArB,EAA8BO,MAA9B;CACA,QAAIC,gBAAJ,EAAsB;CACpBF,aAAOK,UAAP,CAAkBE,KAAlB,CAAwBX,QAAxB,EAAkCK,MAAlC;CACD;CACF;CACF,CApBD;AAqBA,AAAO,KAAMF,mBAAmB/B,UAAQ+B,gBAAjC;;CAEP;;;;AAIA/B,WAAQwC,yBAAR,GAAoC,YAAM;CACxC,MAAMC,UAAU5J,SAASC,aAAT,CAAuB,KAAvB,CAAhB;CACA2J,UAAQ1H,EAAR,GAAa,qBAAb;CACA0H,UAAQ1J,KAAR,CAAcG,UAAd,GAA2B,WAA3B;CACAuJ,UAAQ1J,KAAR,CAAcS,QAAd,GAAyB,MAAzB;CACAiJ,UAAQ1J,KAAR,CAAckB,UAAd,GAA2B,QAA3B;CACAwI,UAAQ1J,KAAR,CAAcoB,SAAd,GAA0B,QAA1B;CACAsI,UAAQ1J,KAAR,CAAc2J,UAAd,GAA2B,MAA3B;CACAD,UAAQ1J,KAAR,CAAc4J,MAAd,GAAuB,iBAAvB;CACAF,UAAQ1J,KAAR,CAAcI,KAAd,GAAsB,MAAtB;CACAsJ,UAAQ1J,KAAR,CAAcE,OAAd,GAAwB,OAAxB;CACAwJ,UAAQ1J,KAAR,CAAcQ,KAAd,GAAsB,OAAtB;CACAkJ,UAAQ1J,KAAR,CAAc6J,MAAd,GAAuB,YAAvB;CACAH,UAAQI,SAAR,GAAoB9C,mBAApB;CACAlH,WAASiK,IAAT,CAActI,WAAd,CAA0BiI,OAA1B;CACD,CAfD;;CCvJA;;;;;;;;;;;;;;;AAeA,CAUA;;;;;KAIMM;;;CACJ;;;;;;;CAOA,qBACEjL,SADF,EAME;CAAA,QAJAkL,WAIA,uEAJc,IAId;CAAA,QAHAC,WAGA,uEAHc,IAGd;CAAA,QAFA9J,KAEA,uEAFQ,QAER;CAAA,QADA8I,MACA,uEADS,IACT;CAAA;;CACA,QAAMb,WAAW,IAAI8B,kBAAJ,CAAiBF,WAAjB,EAA8BC,WAA9B,EAA2C,EAA3C,EAA+C,EAA/C,CAAjB;CACA,QAAME,WAAW,IAAIC,uBAAJ,CAAsB,EAAEjK,YAAF,EAAtB,CAAjB;;CAEA;CACAiI,aAASC,WAAT,CAAqB,IAAIC,aAAJ,GAAc+B,aAAd,CAA4B7B,WAAKC,QAAL,CAAc,CAAC,EAAf,CAA5B,CAArB;;CALA,qHAOML,QAPN,EAOgB+B,QAPhB;;CAQA,UAAKG,OAAL,GAAe,KAAf;;CAEA,UAAKrB,MAAL,GAAcA,MAAd;CACA,UAAKC,gBAAL,GAAwB,IAAxB;CACA,UAAKpK,SAAL,GAAiBA,SAAjB;CACA,UAAKyL,SAAL,GAAiB,IAAI5B,aAAJ,EAAjB;CAbA;CAcD;;CAED;;;;;;;;;;;8BAOyB;CAAA,UAAlBpF,CAAkB,uEAAd,GAAc;CAAA,UAATC,CAAS,uEAAL,GAAK;;CACvB,UAAI,CAAC,KAAK1E,SAAN,IAAmB,CAAC,KAAKA,SAAL,CAAeM,OAAvC,EAAgD;CAC9C;CACD;;CAED,UAAM+D,MAAM,KAAKrE,SAAL,CAAeM,OAAf,CAAuBmE,CAAvB,EAA0BC,CAA1B,CAAZ;CACA,UAAIL,OAAOA,IAAIa,MAAJ,GAAa,CAAxB,EAA2B;CACzB,aAAKsG,OAAL,GAAe,IAAf;CACAvB,yBAAiB,IAAjB,EAAuB5F,IAAI,CAAJ,CAAvB,EAA+B,KAAK+F,gBAApC,EAAsD,KAAKD,MAA3D;CACD;CACF;;;GA/CqBuB;;;;;;CC7BxB;;;;;;;;;;;;;;;AAeA,CAIA;;;;;;;;CAQA,SAASC,SAAT,CAAmBC,EAAnB,EAAuBC,GAAvB,EAA4BC,IAA5B,EAAkC;CAChC,MAAIC,eAAJ;CACA,MAAID,QAAQ,UAAZ,EAAwB;CACtBC,aAASH,GAAGI,YAAH,CAAgBJ,GAAGK,eAAnB,CAAT;CACD,GAFD,MAEO,IAAIH,QAAQ,QAAZ,EAAsB;CAC3BC,aAASH,GAAGI,YAAH,CAAgBJ,GAAGM,aAAnB,CAAT;CACD,GAFM,MAEA;CACL,WAAO,IAAP;CACD;;CAEDN,KAAGO,YAAH,CAAgBJ,MAAhB,EAAwBF,GAAxB;CACAD,KAAGQ,aAAH,CAAiBL,MAAjB;;CAEA,MAAMM,SAAST,GAAGU,kBAAH,CAAsBP,MAAtB,EAA8BH,GAAGW,cAAjC,CAAf;CACA,MAAI,CAACF,MAAL,EAAa;CACXG,UAAMZ,GAAGa,gBAAH,CAAoBV,MAApB,CAAN;CACA,WAAO,IAAP;CACD;;CAED,SAAOA,MAAP;CACD;;CAED;;;;;;;;CAQA,SAASW,UAAT,CAAoBd,EAApB,EAAwBe,EAAxB,EAA4BC,EAA5B,EAAgC;CAC9B,MAAMC,eAAelB,UAAUC,EAAV,EAAce,EAAd,EAAkB,QAAlB,CAArB;CACA,MAAMG,iBAAiBnB,UAAUC,EAAV,EAAcgB,EAAd,EAAkB,UAAlB,CAAvB;CACA,MAAI,CAACE,cAAL,EAAqB;CACnB,WAAO,IAAP;CACD;;CAED,MAAMC,gBAAgBnB,GAAGoB,aAAH,EAAtB;CACApB,KAAGqB,YAAH,CAAgBF,aAAhB,EAA+BF,YAA/B;CACAjB,KAAGqB,YAAH,CAAgBF,aAAhB,EAA+BD,cAA/B;CACAlB,KAAGsB,WAAH,CAAeH,aAAf;;CAEA,MAAMV,SAAST,GAAGuB,mBAAH,CAAuBJ,aAAvB,EAAsCnB,GAAGwB,WAAzC,CAAf;CACA,MAAI,CAACf,MAAL,EAAa;CACXG,UAAM,qCAAN;CACD;;CAED,SAAOO,aAAP;CACD;;CAED;;;;;;;;CAQA,SAASM,mBAAT,CAA6BC,iBAA7B,EAAgDC,2BAAhD,EAA6E;CAC3E,MAAIC,mCAAmC,CAAvC;CACA,UAAQD,2BAAR;CACE,SAAK,EAAL;CACEC,yCAAmC,CAAnC;CACA;CACF,SAAK,GAAL;CACEA,yCAAmC,CAAnC;CACA;CACF,SAAK,GAAL;CACEA,yCAAmC,CAAnC;CACA;CACF;CACEA,yCAAmC,CAAnC;CACA;CAZJ;CAcA,MAAIC,yBAAyB,CAA7B;CACA,UAAQH,iBAAR;CACE,SAAK,EAAL;CACEG,+BAAyB,CAAzB;CACA;CACF,SAAK,GAAL;CACEA,+BAAyB,CAAzB;CACA;CACF,SAAK,GAAL;CACEA,+BAAyB,CAAzB;CACA;CACF;CACEA,+BAAyB,CAAzB;CACA;CAZJ;CAcA,MAAIC,MAAMD,yBAAyBD,gCAAnC;CACA,MAAIE,MAAM,CAAV,EAAa;CACXA,WAAO,CAAP;CACD;CACD,SAAOA,MAAM,CAAb;CACD;;CAED;;;;KAGMC;CACJ;;;;CAIA,2BAAY3N,SAAZ,EAAuB4L,EAAvB,EAA2B;CAAA;;CACzB,SAAK5L,SAAL,GAAiBA,SAAjB;CACA,SAAK4L,EAAL,GAAUA,EAAV;CACA,QAAI,KAAK5L,SAAT,EAAoB;CAClB,WAAK4N,iBAAL,GAAyB5N,UAAU6N,oBAAV,EAAzB;CACA,WAAKC,OAAL,GAAepB,WAAWd,EAAX,EAAemC,YAAf,EAA6BC,cAA7B,CAAf;CACD;;CAEDpC,OAAGqC,UAAH,CAAc,KAAKH,OAAnB;;CAEA;CACA,SAAKI,uBAAL,GAA+BtC,GAAGuC,iBAAH,CAC7B,KAAKL,OADwB,EAE7B,iBAF6B,CAA/B;CAIA,SAAKM,qBAAL,GAA6BxC,GAAGuC,iBAAH,CAC3B,KAAKL,OADsB,EAE3B,eAF2B,CAA7B;;CAKA,SAAKO,cAAL,GAAsBzC,GAAG0C,kBAAH,CAAsB,KAAKR,OAA3B,EAAoC,UAApC,CAAtB;;CAEA,SAAKS,oBAAL,GAA4B3C,GAAG4C,YAAH,EAA5B;CACA5C,OAAG6C,UAAH,CAAc7C,GAAG8C,YAAjB,EAA+B,KAAKH,oBAApC;CACA,QAAII,WAAW,CACb,CAAC,GADY,EAEb,GAFa,EAGb,GAHa,EAIb,CAAC,GAJY,EAKb,CAAC,GALY,EAMb,GANa,EAOb,GAPa,EAQb,GARa,EASb,GATa,EAUb,GAVa,EAWb,CAAC,GAXY,EAYb,GAZa,CAAf;CAcA,QAAIC,cAAc,IAAIC,YAAJ,CAAiBF,QAAjB,CAAlB;CACA/C,OAAGkD,UAAH,CAAclD,GAAG8C,YAAjB,EAA+BE,WAA/B,EAA4ChD,GAAGmD,WAA/C;CACA,SAAKR,oBAAL,CAA0BS,QAA1B,GAAqC,CAArC;CACA,SAAKT,oBAAL,CAA0BU,QAA1B,GAAqC,EAArC;;CAEA,SAAKC,kBAAL,GAA0BtD,GAAG4C,YAAH,EAA1B;CACA5C,OAAG6C,UAAH,CAAc7C,GAAG8C,YAAjB,EAA+B,KAAKQ,kBAApC;CACA;CACA;CACA,QAAIC,gBAAgB,IAApB;CACA,QAAI,KAAKnP,SAAT,EAAoB;CAClB,UAAIoP,IACF,KAAKxB,iBAAL,CAAuBnM,KAAvB,GAA+B,KAAKmM,iBAAL,CAAuByB,YADxD;CAEA,UAAIC,IACF,KAAK1B,iBAAL,CAAuB2B,MAAvB,GAAgC,KAAK3B,iBAAL,CAAuB4B,aADzD;CAEAL,sBAAgB,CACd,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgBG,CAAhB,EAAmBF,CAAnB,EAAsB,GAAtB,EAA2BA,CAA3B,EAA8BE,CAA9B,CADc,EAEd,CAACF,CAAD,EAAI,GAAJ,EAAS,GAAT,EAAc,GAAd,EAAmBA,CAAnB,EAAsBE,CAAtB,EAAyB,GAAzB,EAA8BA,CAA9B,CAFc,EAGd,CAACF,CAAD,EAAIE,CAAJ,EAAOF,CAAP,EAAU,GAAV,EAAe,GAAf,EAAoBE,CAApB,EAAuB,GAAvB,EAA4B,GAA5B,CAHc,EAId,CAAC,GAAD,EAAMA,CAAN,EAASF,CAAT,EAAYE,CAAZ,EAAe,GAAf,EAAoB,GAApB,EAAyBF,CAAzB,EAA4B,GAA5B,CAJc,CAAhB;CAMD,KAXD,MAWO;CACLD,sBAAgB,CACd,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,CADc,EAEd,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,CAFc,EAGd,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,CAHc,EAId,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,CAJc,CAAhB;CAMD;;CAED,SAAKM,gBAAL,GAAwB,EAAxB;CACA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIP,cAAcjK,MAAlC,EAA0CwK,GAA1C,EAA+C;CAC7C,WAAKD,gBAAL,CAAsBE,IAAtB,CAA2B,IAAId,YAAJ,CAAiBM,cAAcO,CAAd,CAAjB,CAA3B;CACD;CACD;CACA;CACA,SAAKE,mBAAL,GAA2BvC,oBACzBwC,OAAOC,WAAP,CAAmBC,KADM,EAEzB,KAAKnC,iBAAL,CAAuBkC,WAFE,CAA3B;;CAKAlE,OAAGkD,UAAH,CACElD,GAAG8C,YADL,EAEE,KAAKe,gBAAL,CAAsB,KAAKG,mBAA3B,CAFF,EAGEhE,GAAGmD,WAHL;CAKA,SAAKG,kBAAL,CAAwBF,QAAxB,GAAmC,CAAnC;CACA,SAAKE,kBAAL,CAAwBD,QAAxB,GAAmC,CAAnC;CACArD,OAAG6C,UAAH,CAAc7C,GAAG8C,YAAjB,EAA+B,IAA/B;;CAEA,SAAKsB,WAAL,GAAmBpE,GAAG4C,YAAH,EAAnB;CACA5C,OAAG6C,UAAH,CAAc7C,GAAGqE,oBAAjB,EAAuC,KAAKD,WAA5C;CACA,QAAIE,UAAU,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,CAAd;CACA,QAAIC,cAAc,IAAIC,WAAJ,CAAgBF,OAAhB,CAAlB;CACAtE,OAAGkD,UAAH,CAAclD,GAAGqE,oBAAjB,EAAuCE,WAAvC,EAAoDvE,GAAGmD,WAAvD;CACA,SAAKiB,WAAL,CAAiBhB,QAAjB,GAA4B,CAA5B;CACA,SAAKgB,WAAL,CAAiBf,QAAjB,GAA4B,CAA5B;CACArD,OAAG6C,UAAH,CAAc7C,GAAGqE,oBAAjB,EAAuC,IAAvC;;CAEA,SAAKI,OAAL,GAAezE,GAAG0E,aAAH,EAAf;CACA1E,OAAGqC,UAAH,CAAc,IAAd;;CAEA;CACA,SAAKvH,gBAAL,GAAwB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAxB;CACA,SAAK6J,QAAL,GAAgB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAhB;CACA,WAAO,IAAP;CACD;;CAED;;;;;;;8BAGS;CACP,UAAI3E,KAAK,KAAKA,EAAd;CACAA,SAAGqC,UAAH,CAAc,KAAKH,OAAnB;CACAlC,SAAG6C,UAAH,CAAc7C,GAAG8C,YAAjB,EAA+B,KAAKH,oBAApC;CACA3C,SAAG4E,uBAAH,CAA2B,KAAKtC,uBAAhC;CACAtC,SAAG6E,mBAAH,CACE,KAAKvC,uBADP,EAEE,KAAKK,oBAAL,CAA0BS,QAF5B,EAGEpD,GAAG8E,KAHL,EAIE,KAJF,EAKE,CALF,EAME,CANF;;CASA9E,SAAG6C,UAAH,CAAc7C,GAAG8C,YAAjB,EAA+B,KAAKQ,kBAApC;;CAEA;CACA;CACA;CACA,UAAIU,sBAAsBvC,oBACxBwC,OAAOC,WAAP,CAAmBC,KADK,EAExB,KAAKnC,iBAAL,CAAuBkC,WAFC,CAA1B;CAIA,UAAIF,wBAAwB,KAAKA,mBAAjC,EAAsD;CACpD,aAAKA,mBAAL,GAA2BA,mBAA3B;CACAhE,WAAGkD,UAAH,CACElD,GAAG8C,YADL,EAEE,KAAKe,gBAAL,CAAsB,KAAKG,mBAA3B,CAFF,EAGEhE,GAAGmD,WAHL;CAKD;CACDnD,SAAG4E,uBAAH,CAA2B,KAAKpC,qBAAhC;CACAxC,SAAG6E,mBAAH,CACE,KAAKrC,qBADP,EAEE,KAAKc,kBAAL,CAAwBF,QAF1B,EAGEpD,GAAG8E,KAHL,EAIE,KAJF,EAKE,CALF,EAME,CANF;;CASA9E,SAAG+E,aAAH,CAAiB/E,GAAGgF,QAApB;CACAhF,SAAGiF,WAAH,CAAejF,GAAGkF,oBAAlB,EAAwC,KAAKT,OAA7C;CACA;CACAzE,SAAGmF,UAAH,CACEnF,GAAGkF,oBADL,EAEE,CAFF,EAGElF,GAAGoF,GAHL,EAIEpF,GAAGoF,GAJL,EAKEpF,GAAGqF,aALL,EAME,KAAKrD,iBANP;CAQAhC,SAAGsF,SAAH,CAAa,KAAK7C,cAAlB,EAAkC,CAAlC;;CAEAzC,SAAG6C,UAAH,CAAc7C,GAAGqE,oBAAjB,EAAuC,KAAKD,WAA5C;;CAEApE,SAAGuF,YAAH,CACEvF,GAAGwF,SADL,EAEE,KAAKpB,WAAL,CAAiBf,QAFnB,EAGErD,GAAGyF,cAHL,EAIE,CAJF;;CAOA;CACAzF,SAAGiF,WAAH,CAAejF,GAAGkF,oBAAlB,EAAwC,IAAxC;CACAlF,SAAG0F,wBAAH,CAA4B,KAAKpD,uBAAjC;CACAtC,SAAG0F,wBAAH,CAA4B,KAAKlD,qBAAjC;CACAxC,SAAG6C,UAAH,CAAc7C,GAAG8C,YAAjB,EAA+B,IAA/B;CACA9C,SAAG6C,UAAH,CAAc7C,GAAGqE,oBAAjB,EAAuC,IAAvC;CACArE,SAAGqC,UAAH,CAAc,IAAd;CACD;;;;;CAGH;;;;;;;KAKMsD;CACJ;;;;CAIA,kBAAYvR,SAAZ,EAAuBwR,QAAvB,EAAiC;CAAA;;CAC/B,SAAKxR,SAAL,GAAiBA,SAAjB;CACA,QAAIwI,QAAQ,KAAKxI,SAAb,CAAJ,EAA6B;CAC3B;CACD;CACD,SAAKwR,QAAL,GAAgBA,QAAhB;CACA,SAAK5F,EAAL,GAAU4F,SAASC,OAAnB;;CAEA,SAAKC,aAAL,GAAqB,IAAI/D,eAAJ,CAAoB3N,SAApB,EAA+B,KAAK4L,EAApC,CAArB;CACA,SAAK+F,aAAL;;CAEA;CACA;CACA,SAAKlQ,KAAL,GAAamQ,OAAOC,UAApB;CACA,SAAKtC,MAAL,GAAcqC,OAAOE,WAArB;CACAF,WAAOrP,gBAAP,CAAwB,QAAxB,EAAkC,KAAKwP,cAAL,CAAoBtP,IAApB,CAAyB,IAAzB,CAAlC,EAAkE,KAAlE;CACD;;CAED;;;;;;;sCAGiB;CACf,WAAKhB,KAAL,GAAamQ,OAAOC,UAApB;CACA,WAAKtC,MAAL,GAAcqC,OAAOE,WAArB;CACD;;CAED;;;;;;8BAGS;CACP,UAAItJ,QAAQ,KAAKxI,SAAb,CAAJ,EAA6B;CAC3B;CACD;;CAED,UAAI4L,KAAK,KAAKA,EAAd;CACA,UAAIoG,MAAMJ,OAAOK,gBAAjB;CACA,UAAIxQ,QAAQ,KAAKA,KAAL,GAAauQ,GAAzB;CACA,UAAIzC,SAAS,KAAKA,MAAL,GAAcyC,GAA3B;;CAEA,UAAIpG,GAAGsG,aAAH,KAAqBzQ,KAAzB,EAAgC;CAC9BmK,WAAGsG,aAAH,GAAmBzQ,KAAnB;CACD;;CAED,UAAImK,GAAGuG,cAAH,KAAsB5C,MAA1B,EAAkC;CAChC3D,WAAGuG,cAAH,GAAoB5C,MAApB;CACD;;CAED,WAAK3D,EAAL,CAAQwG,QAAR,CAAiB,CAAjB,EAAoB,CAApB,EAAuBxG,GAAGsG,aAA1B,EAAyCtG,GAAGuG,cAA5C;CACA,WAAKT,aAAL,CAAmBW,MAAnB;CACA,WAAKV,aAAL;CACD;;CAED;;;;;;qCAGgB;CACd,UAAI,OAAO,KAAKH,QAAL,CAAcc,YAArB,KAAsC,UAA1C,EAAsD;CACpD;CACA,aAAKd,QAAL,CAAcc,YAAd;CACD,OAHD,MAGO;CACL;CACA,aAAKd,QAAL,CAAce,KAAd,CAAoBC,KAApB;CACD;CACF;;;;;CClYH;;;;;;;;;;;;;;;CAeC;CACD,CAAC,YAAW;CACV,MAAIZ,OAAOa,8BAAX,EAA2C;CAAA,QAEhCC,wBAFgC,GAEzC,SAASA,wBAAT,CAAkCxI,MAAlC,EAA0C;CACxCA,aAAOyI,SAAP,GAAmB,EAAnB;CACAzI,aAAO3H,gBAAP,GAA0B,UAASqQ,SAAT,EAAoBC,QAApB,EAA8B;CACtD,YAAI,CAACA,QAAL,EAAe;CACb,iBAAO,IAAP;CACD;CACD,YAAIF,YAAY,KAAKA,SAAL,CAAeC,SAAf,CAAhB;CACA,YAAI,CAACD,SAAL,EAAgB;CACd,eAAKA,SAAL,CAAeC,SAAf,IAA4BD,YAAY,EAAxC;CACD;CACD,YAAIA,UAAUG,OAAV,CAAkBD,QAAlB,IAA8B,CAAlC,EAAqC;CACnCF,oBAAUhD,IAAV,CAAekD,QAAf;CACD;CACD,eAAO,IAAP;CACD,OAZD;CAaA3I,aAAO6I,mBAAP,GAA6B,UAASH,SAAT,EAAoBC,QAApB,EAA8B;CACzD,YAAI,CAACA,QAAL,EAAe;CACb,iBAAO,IAAP;CACD;CACD,YAAIF,YAAY,KAAKA,SAAL,CAAeC,SAAf,CAAhB;CACA,YAAID,SAAJ,EAAe;CACb,cAAIjD,IAAIiD,UAAUG,OAAV,CAAkBD,QAAlB,CAAR;CACA,cAAInD,KAAK,CAAT,EAAY;CACV,iBAAKiD,SAAL,CAAeC,SAAf,IAA4BD,UAAUK,MAAV,CAAiBtD,CAAjB,EAAoB,CAApB,CAA5B;CACD;CACF;CACD,eAAO,IAAP;CACD,OAZD;CAaAxF,aAAO+I,kBAAP,GAA4B,UAASL,SAAT,EAAoBM,KAApB,EAA2B;CACrD,YAAI,CAACA,KAAL,EAAY;CACVA,kBAAQ,EAAEC,QAAS,IAAX,EAAR;CACD;CACD,YAAI,CAACD,MAAMC,MAAX,EAAmB;CACjBD,gBAAMC,MAAN,GAAe,IAAf;CACD;CACDD,cAAMpH,IAAN,GAAa8G,SAAb;CACA,YAAIQ,cAAc,OAAOR,SAAzB;CACA,YAAI,OAAO,KAAKQ,WAAL,CAAP,KAA8B,UAAlC,EAA8C;CAC5C,eAAKA,WAAL,EAAkBF,KAAlB;CACD;CACD,YAAIP,YAAY,KAAKA,SAAL,CAAeC,SAAf,CAAhB;CACA,YAAID,SAAJ,EAAe;CACb,eAAK,IAAIjD,IAAI,CAAb,EAAgBA,IAAIiD,UAAUzN,MAA9B,EAAsCwK,GAAtC,EAA2C;CACzC,gBAAI2D,yBAAwBV,UAAUjD,CAAV,CAAxB,CAAJ;CACA,gBAAI2D,mBAAmB,QAAvB,EAAiC;CAC/BV,wBAAUjD,CAAV,EAAa4D,WAAb,CAAyBJ,KAAzB;CACD,aAFD,MAGK,IAAIG,mBAAmB,UAAvB,EAAmC;CACtCV,wBAAUjD,CAAV,EAAawD,KAAb;CACD;CACF;CACF;CACD,eAAO,IAAP;CACD,OAzBD;CA0BD,KAxDwC;;CA0DzCR,6BAAyBd,OAAOa,8BAAhC;CACA,WACOc,uBAAP,GAAiC,YAAW;CAC1C,aAAO3B,OAAOa,8BAAd;CACD,KAFD;CAGD;CACF,CAjED;;CChBA;;;;;;;;;;;;;;;CAeA;;;;;;;;;;;;;;;;"}